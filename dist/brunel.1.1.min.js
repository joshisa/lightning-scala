var BrunelD3=function(){function h(a,b,c){b=a.width*(b||1/3);c=a.height*(c||1/3);return{x:a.x+(a.width-b)/2,y:a.y+(a.height-c)/2,width:b,height:c}}function y(a,b){var c=[b.a*a.x+b.c*a.y+b.e,b.b*a.x+b.d*a.y+b.f];return{x:c[0],y:c[1],width:b.a*a.width+b.c*a.height,height:b.b*a.width+b.d*a.height}}function g(a,b,c){var e=a.__data__,f,g=b.method;if(b.where)f=a.getBBox(),e=b.where(f,c,e),e={x:e.x,y:e.y,box:f};else if("wedge"==g){b=b.path;f=b.centroid(e);c=Math.atan2(f[1],f[0]);g=1.3333*Math.sqrt(f[0]*
f[0]+f[1]*f[1]);f=Math.cos(c)*g;c=Math.sin(c)*g;var g=b.outerRadius()(e),k=b.innerRadius()(e),e=Math.abs(b.endAngle()(e)-b.startAngle()(e))*(g*g-k*k)/2,e=Math.sqrt(0.75*e)/2,e={x:f,y:c,box:{x:f-e,y:c-e,width:2*e,height:2*e}}}else if("poly"==g)f=a.getTotalLength(),e=a.getPointAtLength(f/4),f=a.getPointAtLength(3*f/4),b=a.getBBox(),e={x:(e.x+f.x)/2,y:(e.y+f.y)/2,box:h(b)};else if("area"==g){c=3.5*c.length;var j=a.getTotalLength(),e=a.getBBox(),g=Math.max(6,e.width/40),l=Math.max(j/g,200),k=Math.round(e.width/
g),r,q,t;f=[];b=[];for(r=0;r<l;r++){q=a.getPointAtLength(j*(r+0.5)/l);t=Math.round((q.x-e.x)/g);if(!f[t]||f[t]<q.y)f[t]=q.y;if(!b[t]||b[t]>q.y)b[t]=q.y}l=k/2;j=0;for(r in b)q=f[r]-b[r],b[r+1]&&b[r-1]&&(q=(2*q+(f[r+1]-b[r+1]+f[r-1]-b[r-1])/2)/3),t=Math.min(r,k-r)*g,t<c?q*=0.01:t<3*c&&(q*=0.8),q>j&&(l=r,j=q);c=e.x+l*g;f=(f[l]+b[l])/2;j<e.height/5&&20>j&&(j=20);e={x:c,y:f,box:{x:c-e.width/3,y:f-j/2,width:e.width/3,height:j}}}else if("path"==g)b.path.centroid?(e=b.path.centroid(e),f=a.getBBox(),e={x:e[0],
y:e[1],box:h(f)}):(e=a.getPointAtLength(a.getTotalLength()/2),f=a.getBBox(),e={x:e.x,y:e.y,box:h(f,1,1/3)});else return f=y(a.getBBox(),a.getCTM()),{x:f.x+("left"==g?-3:"right"==g?f.width+3:f.width/2),y:f.y+("top"==g?-3:"bottom"==g?f.height+3:f.height/2),box:f};f=a.getCTM();a=[f.a*e.x+f.c*e.y+f.e,f.b*e.x+f.d*e.y+f.f];e=y(e.box,f);return{x:a[0],y:a[1],box:e}}function a(a,b,c){for(var e,f=0,g=b.length-3;1<g-f;)e=Math.floor((g+f)/2),a.textContent=b.substring(0,e)+"…",a.getComputedTextLength()<=c?f=e:
g=e;for(;0<f&&-1<" ,.;-".indexOf(b.charAt(f-1));)f--;return 0<f}function b(a,c){if(!a||a.length<=c)return a;if(!c)return"";if(1==c)return a.charAt(0);var e="",f,g,h=a.split(/[ \t\n]+/);if(h.length==c)for(f=0;f<h.length;f++)e+=h[f].charAt(0);else{if(1==h.length){e=h[0];for(g=e.length-2;0<g&&e.length>c;)0<="aeiou".indexOf(e.charAt(g))&&(e=e.substring(0,g)+e.substring(g+1)),g--;return e.length<=c?e:e.substring(0,c)}if(2==h.length)e=h[0].charAt(0)+" "+b(h[1],c-2);else{g=Math.floor((c-(h.length-1))/h.length);
if(1>g)return a.substr(0,c);for(f=0;f<h.length-1;f++)e=e+h[f].substr(0,g)+" ";e+=h[h.length-1].substring(0,c-e.length)}}return e}function c(a,b){b.__transition__?setTimeout(function(){c(a,b)},100):a.call()}function e(b,c,e){var f=e.content(b.__data__);if(f){var h=g(b,e,f),k=b.__label__;k||(k=c.append("text"),b.__label__=k,k.__target__=b,k.__labeling__=e);c=k.node();if(e.fit&&!e.where){for(;c.firstChild;)c.removeChild(c.firstChild);for(var j=f.split(/\s+/),x,w=[],r,q,f=0;f<j.length;f++){if(!q){q=h;
x=c;var t=document.createElementNS("http://www.w3.org/2000/svg","tspan");t.setAttribute("class","label");t.setAttribute("x",q.x);t.setAttribute("y",q.y);x.appendChild(t);q=t}x=j[f];w.push(x);q.textContent=w.join(" ");r=r||c.getBBox().height;if(c.childNodes.length*r>h.box.height){c.removeChild(q);break}if(q.getComputedTextLength()>h.box.width-4){w.pop();if(0==w.length){if(!a(q,x,h.box.width)){c.removeChild(q);break}}else q.textContent=w.join(" "),f--;q=null;w=[]}}if(h=c.childNodes)for(f=0;f<h.length;f++)h[f].setAttribute("dy",
1.1*(f-h.length/2)+0.85+"em")}else if(k.attr("x",h.x).attr("y",h.y).text(f),e.fit&&(r=c.getBBox(),r.height>h.box.height||r.width>h.box.width&&!a(c,f,h.box.width)))c.parentNode.removeChild(c),b.__label__=null;e.cssClass?k.classed(e.cssClass(b.__data__),!0):k.classed("label",!0);b=l[e.method]||l.center;k.style("text-anchor",b[0]).attr("dy",b[1])}}var f,k,j,l={center:["middle","0.3em"],left:["end","0.3em"],"inner-left":["start","0.85em"],right:["start","0.3em"],top:["middle","-0.3em"],bottom:["middle",
"0.7em"]};return{makeData:function(a){var b,c,e,f=[];for(c=0;c<a.names.length;c++)b=a.rows.map(function(a){return a[c]}),b=new BrunelData.Field(a.names[c],null,new BrunelData.values_ColumnProvider(b)),e=a.options?a.options[c]:"string","numeric"==e&&(b=BrunelData.Data.toNumeric(b)),"date"==e&&(b=BrunelData.Data.toDate(b)),"list"==e&&(b=BrunelData.Data.toList(b)),f.push(b);return BrunelData.Dataset.make(f,!1)},geometry:function(a,b,c,e,f,g,h,k,j){var l=a.getBoundingClientRect(),q=l.left,t=l.top,v=l.width,
l=l.height;(a=a.ownerSVGElement)?(a=a.getBoundingClientRect(),q-=a.left,t-=a.top):t=q=0;b={chart_top:t+l*b,chart_bottom:t+l*e,chart_left:q+v*c,chart_right:q+v*f,outer_width:v,outer_height:l,inner_top:g,inner_bottom:k,inner_left:h,inner_right:j,transpose:function(){var a=this.inner_width;this.inner_width=this.inner_height;this.inner_height=a}};b.margin_top=b.chart_top+b.inner_top;b.margin_left=b.chart_left+b.inner_left;b.margin_bottom=l-b.chart_bottom+b.inner_bottom;b.margin_right=v-b.chart_right+
b.inner_right;b.inner_width=b.outer_width-b.margin_left-b.margin_right;b.inner_height=b.outer_height-b.margin_top-b.margin_bottom;b.inner_radius=Math.min(b.inner_width,b.inner_height)/2;b.default_point_size=Math.max(6,0.035*b.inner_radius);return b},addTooltip:function(a,b){function c(a,e){var f=g(a,b,"",e),k=h.getScreenCTM();l.x=f.x+k.e+(document.documentElement.scrollLeft||document.body.scrollLeft);l.y=f.y+k.f+(document.documentElement.scrollTop||document.body.scrollTop);return l}var e=a.node();
if(e){var h=e.ownerSVGElement,k=+h.attributes.width.value,j=+h.attributes.height.value,l=h.createSVGPoint();a.on("mouseover",function(a){var e=b.content(a);if(e){f||(f=document.createElement("div"),document.body.appendChild(f));f.setAttribute("class","brunel tooltip above");f.style.visibility="visible";f.style.width=null;f.innerHTML=e;e=k/3;f.offsetWidth>e&&(f.style.width=e+"px");var e=c(this,a),g=e.y-10-f.offsetHeight;2>g&&e.y<j/2&&(g=b.method,b.method="bottom",e=c(this,a),b.method=g,g=e.y+10,f.setAttribute("class",
"brunel tooltip below"));f.style.left=e.x-f.offsetWidth/2+"px";f.style.top=g+"px"}});a.on("mouseout",function(){f&&(f.style.visibility="hidden")})}},makePathSplits:function(a,b,c){return a._rows.map(a._split).filter(function(a,b,c){return c.indexOf(a)===b}).map(function(e){var f=a._rows.filter(function(b){return a._split(b)==e});c&&f.sort(function(a,b){return c(a)-c(b)});return{path:b(f),key:f[0].key,row:f[0].row}})},locate:function(a,b,c,e){var f,g,h={};for(f=0;f<e;f++)g=a.value(f),null!=g&&(h[g]=
[b.value(f),c.value(f)]);return function(a){return h[a]||[null,null]}},addLegend:function(a,b,c,e,f){a.attr("class","legend").append("text").attr("x",0).attr("y",0).style("text-anchor","end").attr("dy","0.85em").text(b).attr("class","title");a=a.selectAll("legend").data(e).enter().append("g").attr("class","swatch").attr("transform",function(a,b){return"translate(-20,"+(20+20*b)+")"});a.append("rect").attr("x",6).attr("width",14).attr("height",14).style("fill",c);a.append("text").attr("y",7).attr("dy",
".35em").style("text-anchor","end").text(function(a,b){return f?f[b]:BrunelData.Data.format(a,!0)})},centerInWedge:function(a,b,c){b=(b.getTotalLength()/2-c-a.getComputedTextLength())/2;a.firstChild.setAttribute("startOffset",0<b?b:0);a.firstChild.setAttribute("visibility",1>b?"hidden":"visible")},makeRowsWithKeys:function(a,b){for(var c=[],e=0;e<b;e++)c.push({row:e,key:a(e)});return c},label:function(a,b,c,f){return f?a.transition("labels").duration(f).tween("func",function(){var a=this;return function(){e(a,
b,c)}}):a.each(function(){e(this,b,c)})},undoTransform:function(a,b){var c=a.node(),e=b.node().getCTM().inverse(),e=c.ownerSVGElement.createSVGTransformFromMatrix(e);c.transform.baseVal.initialize(e);return a},cloudLayout:function(a,b){function c(a,b){d3.select(this).style("alignment-baseline","auto");var e=this.getBBox(),f=e.height+e.y,g=0.9*f,j=e.height,l=e.width+2,e=0,m;a:{m=this.textContent;var p,n,s=0;for(p=0;p<m.length;p++)if(n=m.charAt(p),0<="bdfhiklt1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(n))s|=
1;else if(0<="gjpqy,".indexOf(n))s|=2;else if(0>"acemnorsuvwxz.-".indexOf(n)){m=3;break a}m=s}0==m?j-=f+g:1==m?(j-=g,e+=g/2):2==m&&(j-=f,e-=f/2);f={width:l,height:j,ox:0,oy:e};1==b%5%2&&(f={height:f.width,width:f.height,oy:0,ox:e,_rotated:!0});f._txt=this;h[b]=f;k+=f.height*f.width}var e=Math.pow(0.8,Math.sqrt(a.rowCount()/200)),f=1*b[0]/Math.max(b[0],b[1]),g=1*b[1]/Math.max(b[0],b[1]),h=[],k=0;return{prepare:c,build:function(){var a,j,l=Math.sqrt(b[0]*b[1]/k/2);for(a=0;a<h.length;a++){j=h[a];var m=
d3.select(j._txt),v=m.style("font-size"),u=v.substring(0,v.length-2),v=v.substring(v.length-2),u=Math.round(u*l)+v;m.style("font-size",u);c.call(j._txt,null,a)}for(a=0;a<h.length;a++){j=h[a];m=!0;u=0;j.title=this.textContent;for(l=a-1;0<=l;l--)j.width>=e*h[l].width&&j.height>e*h[l].height&&(u=Math.max(u,h[l].theta));for(;m;){j.x=Math.cos(u)*u*f;j.y=Math.sin(u)*u*g;j.theta=u;m=!1;for(l=a-1;0<=l;l--)if(j.y+j.height/2>h[l].y-h[l].height/2&&h[l].y+h[l].height/2>j.y-j.height/2&&j.x+j.width/2>h[l].x-h[l].width/
2&&h[l].x+h[l].width/2>j.x-j.width/2){m=!0;break}u+=1/Math.max(1,Math.sqrt(j.x*j.x+j.y*j.y))}l="translate("+(j.x-j.ox)+","+(j.y+j.oy)+")";j._rotated&&(l+="rotate(90, 0, 0) ");j._txt.setAttribute("transform",l);d3.select(j._txt).style("alignment-baseline","middle")}a=h[0]._txt.parentNode;j=h.reduce(function(a,b){return Math.max(a,Math.abs(b.x)+b.width/2)},0);l=h.reduce(function(a,b){return Math.max(a,Math.abs(b.y)+b.height/2)},0);j=Math.min(b[0]/j,b[1]/l)/2;a.setAttribute("transform","scale("+j+")")}}},
select:function(a,b,e,f,g){e.field("#selection");var h=d3.event.altKey?"tog":"sel";d3.event.shiftKey&&(h=d3.event.altKey?"sub":"add");e.modifySelection(h,a,b);c(g,f)},shorten:b,trans:function(a,b){return 0<b?a.transition().duration(b):a},sizedPath:function(){function a(b,c,e){var f=Math.cos(e);e=Math.sin(e);return{a:{x:b.x+b.r*f,y:b.y+b.r*e,r:b.r},b:{x:c.x+c.r*f,y:c.y+c.r*e,r:c.r}}}function b(a,c){return{x:a.x-c.x,y:a.y-c.y}}function c(a,b){return(b?b:"")+a.x.toFixed(1)+" "+a.y.toFixed(1)}function e(a){var f,
g=a[0],j,l=c(g.a);for(f=1;f<a.length;f++){j=a[f];var m;m=g;var s=j,q=b(m.b,m.a),r=b(s.b,s.a),s=b(s.a,m.a),z=q.x*r.y-q.y*r.x;0.01>Math.abs(z)?m=null:(r=(s.x*r.y-s.y*r.x)/z,q=(s.x*q.y-s.y*q.x)/z,m={hit:r>=h&&r<=k&&q>=h&&q<=k,p:{x:m.a.x+(m.b.x-m.a.x)*r,y:m.a.y+(m.b.y-m.a.y)*r}});m?m.hit?l+=c(m.p,"L"):(m=j.a.r.toFixed(1),l+=c(g.b,"L")+"A"+m+" "+m+" 0 0 1 "+c(j.a)):l+=c(j.a,"L");g=j}return l+c(g.b,"L")}function f(b){if(2>b.length)return"";var c,g,h=b[0],k,j=[],l=[];for(c=1;c<b.length;c++)k=b[c],g=Math.atan2(h.y-
k.y,h.x-k.x)+Math.PI/2,j.push(a(h,k,g)),g=a(h,k,g+Math.PI),l.push({a:g.b,b:g.a}),h=k;l.reverse();return"M "+e(j)+" L "+e(l)+"Z"}function g(a){var b,c,e,h,k=[],m=[],p="";for(b=0;b<a.length;b++)if(c=j.call(this,a[b],b),e=l.call(this,a[b],b),h=q.call(this,a[b],b),c&&e&&h){if(c!=m.x||e!=m.y)k.push(m={x:c,y:e,r:h/2})}else p+=f(k),k=[];return p+f(k)}var h=-1E-6,k=1.000001,j=function(a){return a.x},l=function(a){return a.y},q=function(a){return a.r};g.x=function(a){if(!arguments.length)return j;j=a;return g};
g.y=function(a){if(!arguments.length)return l;l=a;return g};g.r=function(a){if(!arguments.length)return q;q=a;return g};return g},tween:function(a,b,c){return b?a.transition("element").duration(b).tween("func",c):a.each(function(a,b){return c.call(this,a,b)()})},addFeatures:function(a,b,c,e,f){if(e._features){var g=[];for(b=0;b<a._rows.length;b++){var h=a._rows[b],k=c?c(h):null;if(k=e._features[k])h.geometry=k.geometry,h.type=k.type,h.geo_properties=k.properties,g.push(h)}a._rows=e._featureExtras.concat(g);
return!1}e._features={};e._featureExtras=[];a=1;var j=Object.keys(b).length;for(g in b)new function(a,b,c){d3.json(a,function(a,g){var h,k,l={};for(h in b)l[b[h]]=h;g.features.forEach(function(a,b){(k=l[a.properties.a])?e._features[k]=a:(e._featureExtras.push(a),a.key="#"+c+"-"+b)});--j||e.build(f)})}(g,b[g],a++);return!0},symbol:function(a,b){b=b||4;if("star"==a){var c=1.5*b,e,f,g,h="M";for(e=0;10>e;e++)f=(e/5-0.5)*Math.PI,0<e&&(h+="L"),g=c*(e%2?0.4:1),h+=g*Math.cos(f)+","+g*Math.sin(f);return h+
"Z"}return d3.svg.symbol().type(a).size(4*b*b)()},network:function(a,b,c,f,g,h){var k=b.nodes.length,j=b.links.length,l=g.default_point_size,r=g.inner_width/2-l,q=g.inner_height/2-l;h=1.57*(h||1)*Math.min(r,q)/Math.sqrt(k);k=h*Math.max(1,h-3)/5/Math.max(1,j/k);a.nodes(b.nodes).links(b.links).size([r,q]).linkDistance(h).charge(-k).start();a.on("tick",function(){var a,b,h,k,j,l,m;c.selection().each(function(c,e){e?(a=Math.min(a,c.x),b=Math.max(b,c.x),h=Math.min(h,c.y),k=Math.max(k,c.y)):(a=b=c.x,h=
k=c.y)}).call(function(){l=(a+b)/2;m=(h+k)/2;j=2*Math.min(r/(b-a),q/(k-h));1.05<j&&(j=1.05);0.95>j&&(j=0.95)}).attr("cx",function(a){return a.x=(a.x-l)*j+g.inner_width/2}).attr("cy",function(a){return a.y=(a.y-m)*j+g.inner_height/2}).each(function(a){var b=this.__label__;b&&(b.__off__?(b.attr("x",b.__off__.dx+a.px),b.attr("y",b.__off__.dy+a.py)):(e(this,null,b.__labeling__),b.__off__={dx:+b.attr("x")-a.x,dy:+b.attr("y")-a.y}))});f.selection().attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",
function(a){return a.target.x}).attr("y2",function(a){return a.target.y})});c.selection().call(a.drag)},facet:function(a,b,c){b.selection().each(function(e){null!=e.row&&(e=b.data().field("#row").value(e.row),a(this,(e.items?e.items:[e]).map(function(a){return a-1})).build(c))})},time:function(a){if(console){var b=(new Date).getTime();k&&console.log("[Time] "+j+" -> "+a+":\t"+(b-k));k=b;j=a}},interpolate:function(a,b,c){return(a+b)/2+c*(a-b)}}}();var BrunelData=function(){var h={extend:function(a,b){var c,e=b.prototype;a.prototype=new function(){};a.prototype.constructor=a;a.$superConstructor=b;a.$super=e;for(c in e)e.hasOwnProperty(c)&&(a.prototype[c]=e[c])},superconstruct:function(a){a.constructor.$superConstructor.apply(a,Array.prototype.slice.call(arguments,1))},extendEnum:function(a){var b=[],c=0,e;for(e in a)if(a.hasOwnProperty(e)){var f=a[e];f.constructor==a&&"prototype"!=e&&(f._ordinal=c++,f._name=e,f.toString=function(){return this._name},
f.ordinal=function(){return this._ordinal},b.push(f))}a.values=function(){return b}},copy:function(a,b){for(var c in b)a[c]=b[c]},iter:function(a){return new h.Iterator(a)},equals:function(a,b){return a===b?!0:null===a||null===b||typeof a!=typeof b?!1:"function"==typeof b.equals?a.equals(b):"function"==typeof a.getTime?a.getTime()==b.getTime():a==b},hash:function(a){return!a?"#":"function"==typeof a.hashCode?a.hashCode():"#"+String(a)},toArray:function(a){return a.constructor===Array?a:"function"==
typeof a.toArray?a.toArray():[a]},Array:function(a,b){var c=Array(a),e=a;if(2<arguments.length)for(var f=Array.prototype.slice.call(arguments,1);e--;)c[e]=h.Array.apply(this,f);else for(e=0;e<a;e++)c[e]=b;return c},compare:function(a,b){if(null==a)return null==b?0:1;if(null==b)return-1;var c=typeof a,e=typeof b;if(c<e)return-1;if(c>e)return 1;if("function"==typeof a.compareTo)return a.compareTo(b);"function"==typeof a.getTime&&(a=a.getTime(),b=b.getTime());return a<b?-1:a>b?1:0},addAll:function(a,
b){for(var c=0;c<b.length;c++)a.add(b[c])},sort:function(a,b){"function"==typeof b?a.sort(b):b?a.sort(function(a,e){return b.compare.call(b,a,e)}):a.sort(h.compare)},toString:function(a){if(!a)return null;if(Array.isArray(a)){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=c?c+(", "+h.toString(a[b])):"["+h.toString(a[b]));return c+"]"}return"function"==typeof a.toString?a.toString():""+a},copyOf:function(a,b){var c,e=h.Array(b,0),f=Math.min(b,h.len(a));for(c=0;c<f;c++)e[c]=a[c];return e},fill:function(a,
b){for(i in a)a.hasOwnProperty(i)&&(a[i]=b)},len:function(a){a=a.length;return"function"==typeof a?a():a},startsWith:function(a,b){return 0==a.indexOf(b)},endsWith:function(a,b){return a.lastIndexOf(b)==a.length-b.length},equalsIgnoreCase:function(a,b){return a===b?!0:null==a||null==b?!1:a.toLowerCase()==b.toLowerCase()},isEmpty:function(a){return a.isEmpty?a.isEmpty():0==h.len(a)},formatInt:function(a,b){var c=""+Math.round(a);if(b){var e=0>a?1:0;if(1E4<=Math.abs(a))for(var f=c.length-3;f>e;f-=3)c=
c.substring(0,f)+","+c.substring(f)}return c},formatScientific:function(a){return a.toExponential(3).replace(/[0]?0e/,"e").replace("+","")},formatFixed:function(a,b){for(var c=a.toPrecision(8),e=c.length;"0"==c.charAt(e-1);)e--;c=c.substring(0,e);if(b)for(var f=0>a?1:0,e=c.indexOf(".")-3;e>f;e-=3)c=c.substring(0,e)+","+c.substring(e);return c},parseDate:function(a){var b=a.indexOf(":"),c=a,e=0,f=0,g=0;if(0<b){for(e=b-1;0<=e&&-1!="0123456789".indexOf(a[e]);)e--;c=0>e?"":a.substring(0,e).trim();a=a.substring(e+
1).trim().split(":");e=parseInt(a[0],10);f=parseInt(a[1],10);2<a.length&&(g=parseInt(a[2],10))}if(0==c.length)return new Date(Date.UTC(1970,0,1,e,f,g));if(-1!=c.indexOf("-"))return a=c.split("-"),c=parseInt(a[0],10),b=parseInt(a[1],10)-1,a=parseInt(a[2],10),new Date(Date.UTC(c,b,a,e,f,g));if(!isNaN(c))return null;c=new Date(c);return isNaN(c.getTime())?null:new Date(c.getTime()+1E3*(60*(60*e+f-c.getTimezoneOffset())+g))},assertEquals:function(a,b,c){if(null!=c&&!(Math.abs(a-b)<c)||null==c&&!h.equals(a,
b))throw"Expected "+a+", but was "+b;},assertNotEquals:function(a,b){if(a==b)throw"Expected inequality, but both were "+a;},assertTrue:function(a){if(!a)throw"Was not true";},Exception:function(a){this.message=a},List:function(a){this.items=[];if(a){a=h.toArray(a);for(var b=0;b<a.length;b++)this.items[b]=a[b]}},Map:function(){this.clear()},Set:function(){this.clear()},Iterator:function(a){a instanceof h.List?(this.target=a,this.useGet=!0,this.N=a.size()):(this.target=h.toArray(a),this.useGet=!1,this.N=
this.target.length);this.i=-1;this.current=this.next()}};h.Iterator.prototype={hasNext:function(){return void 0!==this.current},next:function(){return this.current=++this.i>=this.N?void 0:this.useGet?this.target.get(this.i):this.target[this.i]}};h.Exception.prototype={getMessage:function(){return this.message},toString:function(){return this.message}};h.List.prototype={add:function(a){this.items.push(void 0===a?null:a)},addAll:function(a){this.items=this.items.concat(h.toArray(a))},get:function(a){return this.items[a]},
set:function(a,b){this.items[a]=b},sort:function(a){h.sort(this.items,a)},clear:function(){this.items=[]},size:function(){return this.items.length},toArray:function(){return[].concat(this.items)},isEmpty:function(){return 0==this.items.length},remove:function(a){this.items.splice(a,1)},contains:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]==a)return!0;return!1},indexOf:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]==a)return b;return-1},toString:function(){return"["+
this.items.join(", ")+"]"}};h.Map.prototype={size:function(){return this.count},clear:function(){this.items={};this.count=0},isEmpty:function(){return 0==this.count},put:function(a,b){var c=h.hash(a),e=this.items[c];if(!e)return e=[[a,b]],this.items[c]=e,this.count++,null;c=this._findInArray(a,e);if(0>c)return e.push([a,b]),this.count++,null;var f=e[c][1];e[c][1]=b;return f},remove:function(a){var b=this.items[h.hash(a)];a=this._findInArray(a,b);if(0>a)return null;this.count--;return b.splice(a,1)[0][1]},
putAll:function(a){var b,c,e=a.items;for(b in e)if(e.hasOwnProperty(b)){a=e[b];for(c=0;c<a.length;c++)this.put(a[c][0],a[c][1])}},values:function(){var a,b,c,e=new h.List,f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=f[a];for(c=0;c<b.length;c++)e.add(b[c][1])}return e},get:function(a){var b=this.items[h.hash(a)];a=this._findInArray(a,b);return 0<=a?b[a][1]:null},keySet:function(){var a,b,c,e=new h.Set,f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=f[a];for(c=0;c<b.length;c++)e.add(b[c][0])}return e},
containsKey:function(a){var b=this.items[h.hash(a)];return 0<=this._findInArray(a,b)},toArray:function(){var a,b,c,e=[],f=this.items;for(a in f)if(f.hasOwnProperty(a)){b=f[a];for(c=0;c<b.length;c++)e.push(b[c][0])}return e},toString:function(){var a=this;return"{"+this.toArray().map(function(b){return b+"="+a.get(b)}).join(", ")+"}"},_findInArray:function(a,b){if(b)for(var c=0;c<b.length;c++)if(h.equals(a,b[c][0]))return c;return-1}};h.extend(h.Set,h.Map);h.Set.prototype.contains=h.Set.prototype.containsKey;
h.Set.prototype.add=function(a){return!this.put(a,a)};h.Set.prototype.addAll=h.Set.prototype.putAll;h.Set.prototype.toString=function(){return"["+this.toArray().join(", ")+"]"};if(!String.prototype.trim){var y=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(y,"")}}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var g={version:"0.0.3",auto_Auto:function(){}};g.auto_Auto.FRACTION_TO_CONVERT=0.5;h.copy(g.auto_Auto,
{makeNumericScale:function(a,b,c,e,f,h){var j;g.auto_Auto.setTransform(a);1>f&&(f=Math.min(g.auto_Auto.optimalBinCount(a),20)+1);if(a.isDate())return g.auto_NumericScale.makeDateScale(a,b,c,f);j=a.strProperty("transform");if("log"==j)return g.auto_NumericScale.makeLogScale(a,b,c,e,f);"root"==j&&0<a.min()&&(j=a.min()/a.max()/(Math.sqrt(a.min())/Math.sqrt(a.max())),e*=j,c[0]*=j);return g.auto_NumericScale.makeLinearScale(a,b,e,c,f,h)},setTransform:function(a){var b;null==a.property("transform")&&(b=
a.numProperty("skew"),null==b?a.set("transform","linear"):2<b&&0<a.min()&&a.max()>75*a.min()?a.set("transform","log"):1<b&&0<=a.min()?a.set("transform","root"):a.set("transform","linear"))},optimalBinCount:function(a){var b,c;if(!a.isNumeric())return Math.min(7,a.categories().length);b=2*(a.numProperty("q3")-a.numProperty("q1"))/Math.pow(a.valid(),0.33333);c=3.5*a.numProperty("stddev")/Math.pow(a.valid(),0.33333);b=Math.max(b,c);return 0==b?1:Math.round((a.max()-a.min())/b+0.499)},convert:function(a){var b,
c,e,f,k,j;if(a.isSynthetic()||a.isDate()||a.isProperty("list"))return a;b=g.Data.toList(a);if(g.auto_Auto.goodLists(b))return b;b=a.valid();j=h.Array(a.rowCount(),0);for(c=0;c<j.length;c++)j[c]=c;for(c=0;c<j.length;c++)e=Math.floor(Math.random()*(j.length-c)),k=j[c],j[c]=j[e],j[e]=k;if(a.isNumeric())c=a;else{for(f=c=e=0;e<b&&50>e;)k=a.value(j[c++]),null!=k&&(e++,!(k instanceof Date)&&null!=g.Data.asNumeric(k)&&f++);c=f>g.auto_Auto.FRACTION_TO_CONVERT*e?g.Data.toNumeric(a):null}if(null!=c)return g.auto_Auto.isYearly(c)?
g.Data.toDate(c,"year"):c;for(f=c=e=0;e<b&&50>e;)k=a.value(j[c++]),null!=k&&(e++,null!=g.Data.asDate(k)&&f++);return f>g.auto_Auto.FRACTION_TO_CONVERT*e?g.Data.toDate(a):a},goodLists:function(a){var b,c,e,f=a.valid();if(3>f)return!1;c=-1;for(b=1;b<a.rowCount();b++)if(e=a.value(b),null!=e)if(0>c)c=e.size();else if(e.size()!=c){if(20>f)return!0;a=a.property("listCategories").length;return a*a<2*f}return!1},isYearly:function(a){if(1600>a.min()||2100<a.max())return!1;a=a.numProperty("granularity");return null!=
a&&1E-6>a-Math.floor(a)}});g.auto_NumericScale=function(a,b,c,e,f){this.type=a;this.min=b;this.max=c;this.divisions=e;this.granular=f};g.auto_NumericScale.HALF_LOG=3;h.copy(g.auto_NumericScale,{makeDateScale:function(a,b,c,e){var f,k,j=a.min(),l=a.max();j==l?(a=a.property("dateUnit"),j=g.Data.asNumeric(g.util_DateUnit.increment(g.Data.asDate(j),a,-1)),l=g.Data.asNumeric(g.util_DateUnit.increment(g.Data.asDate(l),a,1))):(j-=c[0]*(l-j),l+=c[1]*(l-j));e=(l-j)/(e-1);a=g.stats_DateStats.getUnit(4*e);c=
g.auto_NumericScale.bestDateMultiple(a,e);k=g.util_DateUnit.floor(g.Data.asDate(j),a,c);b&&(j=g.Data.asNumeric(k));for(e=new h.List;;){f=g.Data.asNumeric(k);if(f>=l){if(b||f==l)l=f,e.add(f);break}f>=j&&e.add(f);k=g.util_DateUnit.increment(k,a,c)}b&&(l=g.Data.asNumeric(k));b=e.toArray();return new g.auto_NumericScale("date",j,l,b,!1)},bestDateMultiple:function(a,b){var c,e=b/a.approxDaysPerUnit,f=1;for(c=2;c<=a.base/2;c++)0==a.base%c&&4!=c&&(6==c&&60==a.base||Math.abs(e-c)<=Math.abs(e-f)&&(f=c));return f},
makeLinearScale:function(a,b,c,e,f,k){var j,l,m,p,n,s;if(0==a.valid())return new g.auto_NumericScale("linear",0,1,[0,1],!1);l=a.min();j=a.max();m=e[0]*(j-l);e=e[1]*(j-l);l-=m;m=j+e;0<l&&l/m<=c&&(l=0);0>m&&m/l<=c&&(m=0);0==l&&(1.0001>=j&&1<m&&(m=1),100.001>j&&100<m&&(m=100));l+1E-9>m&&(m=Math.max(0,2*l),l=Math.min(0,2*l),0==l&&0==m&&(l=0,m=1));j=Math.max(f-1,1);c=a.strProperty("transform");p=a.numProperty("granularity");e=(m-l)/p;if((k||a.preferCategorical())&&e>j/2&&e<2*j)return b=g.auto_NumericScale.makeGranularDivisions(l,
m,p,b),new g.auto_NumericScale(c,l,m,b,!0);a=Math.floor(Math.log((m-l)/j)/Math.log(10));k=Math.pow(10,a);e=1E9;j=h.iter([k,10*k,k/10,5*k,k/2,2*k,k/5]);for(a=j.current;j.hasNext();a=j.next())s=a*Math.ceil(l/a),n=a*Math.floor(m/a),p=Math.round((n-s)/a)+1,b&&l<s&&p++,b&&m>n&&p++,n=Math.abs(p-f),p>f&&(n-=0.001),n<e&&(e=n,k=a);f=k*Math.floor(l/k);b&&(l=f,m=k*Math.ceil(m/k));f<l-1E-6&&(f+=k);for(a=new h.List;f<m+1E-6;)a.add(f),f+=k;b=a.toArray();return new g.auto_NumericScale(c,l,m,b,!1)},makeGranularDivisions:function(a,
b,c,e){var f=new h.List;e||(a+=c,b-=c);for(a-=c/2;a<b+c;)f.add(a),a+=c;return f.toArray()},makeLogScale:function(a,b,c,e,f){var k,j;j=Math.log(a.min())/Math.log(10);k=Math.log(a.max())/Math.log(10);c=Math.max(c[0],c[1]);j-=c*(k-j);k+=c*(k-j);0.5<e&&0==j&&(j=-0.5);0<j&&j/k<=e&&(j=0);b&&(j=Math.floor(j),k=Math.ceil(k));e=k-j+1;b=e<0.666*f;c=e>1.66*f?100:10;e=new h.List;f=Math.pow(10,j);k=Math.pow(10,k);b&&k/2>a.max()&&(k/=2);j=Math.pow(10,Math.ceil(j));for(a=1.001*k;j<a;)e.add(j),b&&j*g.auto_NumericScale.HALF_LOG<
a&&e.add(j*g.auto_NumericScale.HALF_LOG),j*=c;a=e.toArray();return new g.auto_NumericScale("log",f,k,a,!1)}});g.Data=function(){};h.copy(g.Data,{indexOf:function(a,b){for(var c,e=-1,f=b.length;1<f-e;)c=Math.floor((f+e)/2),b[c]<=a?e=c:f=c;return e},join:function(a,b){var c,e,f,k;null==b&&(b=", ");k="";e=!0;c=h.iter(a);for(f=c.current;c.hasNext();f=c.next())e||(k+=b),k+=g.Data.format(f,!1),e=!1;return k},format:function(a,b){return null==a?"?":"number"==typeof a?g.Data.formatNumeric(a,b):""+a},formatNumeric:function(a,
b){return 0==a?"0":1E-6>=Math.abs(a)||1E8<=Math.abs(a)?h.formatScientific(a):1E-9>Math.abs((a-Math.round(a))/a)?h.formatInt(Math.round(a),b):h.formatFixed(a,b)},asNumeric:function(a){if(null==a)return null;if(a&&a.asNumeric)return a.asNumeric();if(a&&a.getTime)return a.getTime()/864E5;a=Number(a);return!isNaN(a)?a:null},sort:function(a){h.sort(a,g.Data.compare)},compare:function(a,b){return h.compare(a,b)},toDate:function(a,b){var c,e,f,k,j;if(a.isDate())return a;e=h.Array(a.rowCount(),null);c=!1;
for(f=0;f<e.length;f++)k=a.value(f),"year"==b?(j=g.Data.asNumeric(k),null!=j&&(e[f]=g.Data.asDate(g.Data.format(j,!1)+"-01-01"))):"excel"==b?(j=g.Data.asNumeric(k),null!=j&&(e[f]=g.Data.asDate(j-24107))):e[f]=g.Data.asDate(k),c||(c=0!=g.Data.compare(k,e[f]));c=g.Fields.makeColumnField(a.name,a.label,e);c.set("date",!0);c.setNumeric();return c},asDate:function(a){return null==a?null:a.getTime?a:"string"==typeof a?(d=h.parseDate(a),null==d||isNaN(d.getTime())?null:d):!isNaN(a)?new Date(864E5*a):null},
toNumeric:function(a){var b,c,e;if(a.isNumeric())return a;b=h.Array(a.rowCount(),0);for(c=0;c<b.length;c++)e=a.value(c),b[c]=g.Data.asNumeric(e);a=g.Fields.makeColumnField(a.name,a.label,b);a.setNumeric();return a},toList:function(a){var b,c,e,f,k,j,l,m,p=",";k=-1;b=h.iter([",",";","|"]);for(l=b.current;b.hasNext();l=b.next()){e=0;c=h.iter(a.categories());for(f=c.current;c.hasNext();f=c.next())0<=f.toString().indexOf(e)&&e++;e>k&&(p=l,k=e)}j=a.rowCount();c=new h.Map;k=h.Array(j,null);for(e=0;e<j;e++)if(f=
a.value(e),null!=f){m=new h.List;b=h.iter(g.Data.split(f.toString(),p));for(l=b.current;b.hasNext();l=b.next())l=l.trim(),0<h.len(l)&&(f=c.get(l),null==f&&(f=l,c.put(f,l)),m.add(f));k[e]=new g.util_ItemsList(m.toArray())}a=g.Fields.makeColumnField(a.name,a.label,k);f=c.values().toArray();h.sort(f);a.set("list",!0);a.set("listCategories",f);return a},split:function(a,b){return a.split(b)},isQuoted:function(a){var b;if(null==a||2>h.len(a))return!1;b=a.charAt(0);return'"'==b||"'"==b&&a.charAt(h.len(a)-
1)==b},deQuote:function(a){var b,c,e="",f=h.len(a)-1;for(c=1;c<f;c++)b=a.charAt(c),"\\"==b?(b=a.charAt(++c),e="n"==b?e+"\n":"t"==b?e+"\t":e+b):e+=b;return e},quote:function(a){var b,c,e,f,g;if(null==a)return"null";f="'";0<=a.indexOf(f)&&(f='"');g="";e=h.len(a);for(c=0;c<e;c++)b=a.charAt(c),g="\n"==b?g+"\\n":"\t"==b?g+"\\t":"\\"==b?g+"\\\\":b==f?g+("\\"+b):g+b;return f+g+f},order:function(a,b){for(var c=[],e=0;e<a.length;e++)c.push(e);c.sort(function(c,e){var g=h.compare(a[c],a[e]);return b?g:-g});
return c},toPrimitive:function(a){return a}});g.util_Informative=function(){this.info=new h.Map};h.copy(g.util_Informative.prototype,{copyProperties:function(a){var b=Array.prototype.slice.call(arguments,1),c,b=h.iter(b);for(c=b.current;b.hasNext();c=b.next())this.set(c,a.property(c))},copyAllProperties:function(a){this.info.putAll(a.info)},numProperty:function(a){return g.Data.asNumeric(this.property(a))},property:function(a){return this.info.get(a)},strProperty:function(a){a=this.property(a);return null==
a?null:a.toString()},isProperty:function(a){a=this.property(a);return null!=a&&a},set:function(a,b){null==b?this.info.remove(a):this.info.put(a,b)}});g.Dataset=function(a){var b,c;h.superconstruct(this);this.fieldByName=this.fields=null;this.fields=g.Dataset.ensureUniqueNames(a);this.fieldByName=new h.Map;b=h.iter(a);for(c=b.current;b.hasNext();c=b.next())this.fieldByName.put(c.name.toLowerCase(),c);b=h.iter(a);for(c=b.current;b.hasNext();c=b.next())this.fieldByName.put(c.name,c)};h.extend(g.Dataset,
g.util_Informative);h.copy(g.Dataset,{make:function(a,b){var c,e;a=g.Dataset.ensureUniqueNames(a);c=h.Array(a.length+3,null);for(e=0;e<a.length;e++)c[e]=!1==b?a[e]:g.auto_Auto.convert(a[e]);e=0==a.length?0:a[0].rowCount();c[a.length]=g.Fields.makeConstantField("#count","Count",1,e);c[a.length+1]=g.Fields.makeIndexingField("#row","Row",e);e=g.Fields.makeConstantField("#selection","Selection","✗",e);c[a.length+2]=e;return new g.Dataset(c)},ensureUniqueNames:function(a){var b,c,e,f,g=new h.Set;g.add("");
f=h.Array(a.length,null);for(b=0;b<a.length;b++){e=a[b].name;null==e&&(e="");if(g.contains(e))for(c=1;c<a.length+1;c++){if(!g.contains(e+"_"+c)){f[b]=a[b].rename(e+"_"+c,e);break}}else f[b]=a[b];g.add(f[b].name)}return f}});h.copy(g.Dataset.prototype,{retainRows:function(a){var b,c=h.Array(this.fields.length,null);for(b=0;b<c.length;b++)c[b]=g.Fields.permute(this.fields[b],a,!1);return this.replaceFields(c)},transform:function(a){return g.modify_Transform.transform(this,a)},removeSpecialFields:function(){var a,
b,c=new h.List;a=h.iter(this.fields);for(b=a.current;a.hasNext();b=a.next())h.startsWith(b.name,"#")||c.add(b);a=c.toArray();return this.replaceFields(a)},addConstants:function(a){return g.modify_AddConstantFields.transform(this,a)},expectedSize:function(){var a,b,c=56*this.fields.length+56;a=h.iter(this.fields);for(b=a.current;a.hasNext();b=a.next())c+=b.expectedSize();return c},field:function(a,b){var c=this.fieldByName.get(a);return null!=c||!b?c:this.fieldByName.get(a.toLowerCase())},fieldArray:function(){var a=
Array.prototype.slice.call(arguments,0),b,c=h.Array(a.length,null);for(b=0;b<c.length;b++)c[b]=this.field(a[b],!1);return c},filter:function(a){return g.modify_Filter.transform(this,a)},each:function(a){return g.modify_Each.transform(this,a)},replaceFields:function(a){a=new g.Dataset(a);a.copyAllProperties(this);return a},rowCount:function(){return 0==this.fields.length?0:this.fields[0].rowCount()},name:function(){return this.strProperty("name")},reduce:function(a){var b,c,e=new h.Set;h.addAll(e,
g.modify_DataOperation.strings(a,";"));c=new h.List;a=h.iter(this.fields);for(b=a.current;a.hasNext();b=a.next())(h.startsWith(b.name,"#")||e.contains(b.name))&&c.add(b);return this.replaceFields(c.toArray())},series:function(a){return g.modify_ConvertSeries.transform(this,a)},sort:function(a){return g.modify_Sort.transform(this,a,!0)},sortRows:function(a){return g.modify_Sort.transform(this,a,!1)},stack:function(a){return g.modify_Stack.transform(this,a)},summarize:function(a){a=g.modify_Summarize.transform(this,
a);a.set("reduced",!0);return a},modifySelection:function(a,b,c){var e,f=g.Field.VAL_UNSELECTED,k=g.Field.VAL_SELECTED,j=this.field("#selection"),l=this.rowCount();if("sel"==a)for(e=0;e<l;e++)j.setValue(f,e);e=c.expandedOriginalRows(b);b=h.iter(e);for(e=b.current;b.hasNext();e=b.next())"sel"==a||"add"==a?j.setValue(k,e):"sub"==a?j.setValue(f,e):j.setValue(j.value(e)==k?f:k,e)},expandedOriginalRows:function(a){var b,c,e,f,k,j,l=this.rowCount();e=new h.Set;b=h.iter(this.fields);for(c=b.current;b.hasNext();c=
b.next())!c.isSynthetic()&&null==c.property("derived")&&e.add(c);b=e.toArray();b=new g.summary_FieldRowComparison(b,null,!1);j=this.field("#row");c=new h.Set;for(e=0;e<l;e++)if(0==b.compare(e,a))if(f=j.value(e),f instanceof g.util_ItemsList){k=f;for(f=0;f<k.size();f++)c.add(k.get(f)-1)}else null!=f&&c.add(f-1);return c}});g.diagram_Chord=function(a,b,c,e){var f,k,j,l;b=a.field(b);c=a.field(c);a=a.field(e);e=(new g.util_MapInt).index(b.categories()).index(c.categories());f=e.size();this.names=e.getIndexedKeys();
this.mtx=h.Array(f,f,0);this.idx=h.Array(f,f,0);for(f=0;f<b.rowCount();f++)l=null==a?1:g.Data.asNumeric(a.value(f)),0<l&&(k=e.get(b.value(f)),j=e.get(c.value(f)),this.mtx[k][j]+=l,this.mtx[j][k]+=l,this.idx[k][j]=f,this.idx[j][k]=f)};h.copy(g.diagram_Chord,{make:function(a,b,c,e){return new g.diagram_Chord(a,b,c,e)}});h.copy(g.diagram_Chord.prototype,{group:function(a){return this.names[a]},index:function(a,b){return this.idx[a][b]},matrix:function(){return this.mtx}});g.diagram_Edge=function(a,b,
c){this.row=c;this.source=a;this.target=b;this.key=a.key+"--"+b.key};g.diagram_Graph=function(a,b,c){var e,f,k,j=new h.Map,l=new h.List;for(e=0;e<a.rowCount();e++)k=a.value(e),null!=k&&(f=new g.diagram_Node(e,1,k.toString(),null),f.key=k,l.add(f),j.put(k,f));a=new h.List;for(e=0;e<b.rowCount();e++)f=j.get(b.value(e)),k=j.get(c.value(e)),null!=f&&null!=k&&a.add(new g.diagram_Edge(f,k,e));this.nodes=l.toArray();this.links=a.toArray()};h.copy(g.diagram_Graph,{make:function(a,b,c,e,f){a=a.field(b);e=
c.field(e);c=c.field(f);return new g.diagram_Graph(a,e,c)}});g.diagram_Hierarchical=function(a,b,c){b=null==b?null:a.field(b);c=this.toFields(a,c);this.root=this.makeInternalNode("");this.makeNodesUsingCollections(a,b,c);this.replaceCollections(this.root)};h.copy(g.diagram_Hierarchical,{makeByNestingFields:function(a,b){var c=Array.prototype.slice.call(arguments,2);return new g.diagram_Hierarchical(a,b,c)}});h.copy(g.diagram_Hierarchical.prototype,{makeInternalNode:function(a){a=new g.diagram_Node(null,
0,a,new h.List);a.temp=new h.Map;return a},makeNodesUsingCollections:function(a,b,c){var e,f,k,j,l,m,p,n;for(p=0;p<a.rowCount();p++)if(j=null==b?1:g.Data.asNumeric(b.value(p)),0<j){k=this.root;e=h.iter(c);for(l=e.current;e.hasNext();l=e.next())m=k.temp,f=k.children,n=l.value(p),k=m.get(n),null==k&&(k=this.makeInternalNode(l.valueFormatted(p)),f.add(k),m.put(n,k));k.children.add(new g.diagram_Node(p,j,null,null))}},replaceCollections:function(a,b){var c,e;c=a.children;if(null!=c){a.children=c.toArray();
a.temp=null;a.key=null==b?a.innerNodeName:b+"-"+a.innerNodeName;c=h.iter(c);for(e=c.current;c.hasNext();e=c.next())this.replaceCollections(e,a.key)}},toFields:function(a,b){var c,e=h.Array(b.length,null);for(c=0;c<e.length;c++)e[c]=a.field(b[c]);return e}});g.diagram_Node=function(a,b,c,e){this.temp=this.children=this.key=null;this.row=a;this.value=b;this.innerNodeName=c;this.children=e};g.Field=function(a,b,c,e){h.superconstruct(this);this.provider=null;this.calculatedDate=this.calculatedNumeric=
this.calculatedNominal=!1;this.categoryOrder=null;this.name=a;this.label=null==b?a:b;this.provider=c;null!=e&&(null==c&&(e.makeNominalStats(),e.makeNumericStats(),e.makeDateStats()),this.copyAllProperties(e))};g.Field.VAL_SELECTED="✓";g.Field.VAL_UNSELECTED="✗";h.extend(g.Field,g.util_Informative);h.copy(g.Field.prototype,{setValue:function(a,b){this.provider=this.provider.setValue(a,b)},compareRows:function(a,b){null==this.categoryOrder&&(this.categoryOrder=new g.util_MapInt,this.preferCategorical()&&
this.categoryOrder.index(this.categories()));return this.provider.compareRows(a,b,this.categoryOrder)},expectedSize:function(){return 2*(h.len(this.label)+h.len(this.name))+108+this.provider.expectedSize()},property:function(a){var b=g.Field.$super.property.call(this,a);null==b&&(!this.calculatedNominal&&g.stats_NominalStats.creates(a)&&(this.makeNominalStats(),b=g.Field.$super.property.call(this,a)),!this.calculatedNumeric&&g.stats_NumericStats.creates(a)&&(this.calculatedNominal||this.makeNominalStats(),
this.makeNumericStats(),b=g.Field.$super.property.call(this,a)),!this.calculatedDate&&g.stats_DateStats.creates(a)&&(this.isDate()?(this.calculatedNominal||this.makeNominalStats(),this.calculatedNumeric||this.makeNumericStats(),this.makeDateStats(),b=g.Field.$super.property.call(this,a)):this.calculatedDate=!0));return b},setCategories:function(a){this.set("categories",a);this.set("categoriesOrdered",!0)},makeDateStats:function(){this.isNumeric()&&g.stats_DateStats.populate(this);this.calculatedDate=
!0},isNumeric:function(){return this.isProperty("numeric")},setNumeric:function(){this.set("numeric",!0)},isDate:function(){return this.isProperty("date")},isBinned:function(){return this.isProperty("binned")},makeNumericStats:function(){null!=this.provider&&g.stats_NumericStats.populate(this);this.calculatedNumeric=!0},makeNominalStats:function(){null!=this.provider&&g.stats_NominalStats.populate(this);this.calculatedNominal=!0},categories:function(){return this.property("categories")},compareTo:function(a){var b=
g.Data.compare(this.name,a.name);return h.startsWith(this.name,"#")?h.startsWith(a.name,"#")?b:1:h.startsWith(a.name,"#")?-1:b},dropData:function(){return new g.Field(this.name,this.label,null,this)},max:function(){return this.property("max")},min:function(){return this.property("min")},isSynthetic:function(){return h.startsWith(this.name,"#")},preferCategorical:function(){return!this.isNumeric()||this.isBinned()},ordered:function(){return this.isNumeric()||"#selection"==this.name},rename:function(a,
b){var c=new g.Field(a,b,this.provider);c.copyAllProperties(this);return c},rowCount:function(){return null!=this.provider?this.provider.count():this.numProperty("n")},toString:function(){return this.name},uniqueValuesCount:function(){return Math.round(this.numProperty("unique"))},valid:function(){return this.property("valid")},value:function(a){return this.provider.value(a)},valueFormatted:function(a){return this.format(this.provider.value(a))},format:function(a){return null==a?"?":a instanceof g.util_Range?
a.toString():this.isDate()?this.property("dateFormat").format(g.Data.asDate(a)):"percent"==this.property("summary")?(a=g.Data.asNumeric(a),null==a?null:g.Data.formatNumeric(Math.round(10*a)/10,!1)+"%"):this.isNumeric()?(a=g.Data.asNumeric(a),null==a?"?":g.Data.formatNumeric(a,!0)):this.isProperty("list")?a.toString(this.property("dateFormat")):a.toString()}});g.Fields=function(){};h.copy(g.Fields,{makeConstantField:function(a,b,c,e){a=new g.Field(a,b,new g.values_ConstantProvider(c,e));null!=g.Data.asNumeric(c)&&
a.setNumeric();return a},makeIndexingField:function(a,b,c){a=new g.Field(a,b,new g.values_RowProvider(c));a.setNumeric();return a},makeColumnField:function(a,b,c){return new g.Field(a,b,new g.values_ColumnProvider(c))},permute:function(a,b,c){if(a.provider instanceof g.values_ConstantProvider)return c?a:g.Fields.makeConstantField(a.name,a.label,a.value(0),b.length);if(c)return new g.Field(a.name,a.label,new g.values_ReorderedProvider(a.provider,b),a);b=new g.Field(a.name,a.label,new g.values_ReorderedProvider(a.provider,
b));g.Fields.copyBaseProperties(a,b);return b},copyBaseProperties:function(a,b){b.copyProperties(a,"numeric","binned","summary","transform","list","listCategories","date","categoriesOrdered","dateUnit","dateFormat");a.isProperty("categoriesOrdered")&&b.set("categories",a.property("categories"))}});g.io_ByteInput=function(a){this.p=0;this.data=a;this.p=0};h.copy(g.io_ByteInput.prototype,{readNumber:function(){var a,b;a=this.readByte()&255;if(252>=a)return a;if(253==a)return a=this.readByte()&255,b=
this.readByte()&255,a+256*b;if(254==a)return this.readDouble();if(255==a)return null;throw new h.Exception("Serializing "+a);},readDate:function(){return g.Data.asDate(this.readNumber())},readDouble:function(){var a=this.readString();return"NaN"==a?Number.NaN:Number(a)},readString:function(){for(var a,b,c="";;){a=this.readByte();if(3==a&&""==c)return null;if(0==a)return c;b=a>>4;if(8>b)c+=String.fromCharCode(a);else if(12==b||13==b)c+=String.fromCharCode((a&31)<<6|this.readByte()&63);else if(14==
b){b=this.readByte();var e=this.readByte(),c=c+String.fromCharCode((a&15)<<12|(b&63)<<6|e&63)}}},readByte:function(){return this.data[this.p++]}});g.io_ByteOutput=function(){this.out=[]};h.copy(g.io_ByteOutput.prototype,{addByte:function(a){this.out.push(a);return this},addNumber:function(a){var b;if(null==a)return this.addByte(255),this;b=Math.floor(a);if(b==a&&0<=b&&65536>b){if(252>=b)return this.addByte(b);this.addByte(253);this.addByte(b&255);this.addByte(b>>8&255);return this}this.addByte(254);
this.addDouble(a);return this},addDouble:function(a){isNaN(a)?this.addString("NaN"):this.addString(g.Data.formatNumeric(a,!1))},addDate:function(a){this.addNumber(g.Data.asNumeric(a))},addString:function(a){if(null==a)return this.addByte(3);for(var b=0;b<a.length;b++){var c=a.charCodeAt(b);128>c?this.addByte(c):2048>c?this.addByte(c>>6|192).addByte(c&63|128):this.addByte(c>>12|224).addByte(c>>6&63|128).addByte(c&63|128)}return this.addByte(0)},asBytes:function(){return this.out}});g.io_CSV=function(){};
h.copy(g.io_CSV,{read:function(a){a=g.io_CSV.parse(a);return g.io_CSV.makeFields(a)},parse:function(a){var b,c;c=new h.Map;for(var e=new h.List,f=new h.List,k=" ",j=!1,l=!1,m=0,p=g.io_CSV.findSeparator(a),n=null,s=-1;m<=h.len(a);){b=m==h.len(a)?"\n":a.charAt(m);if(j)'"'==b?m<h.len(a)-1&&'"'==a.charAt(m+1)?(n+='"',m++):j=!1:n+=b;else if("\n"==b||"\r"==b){if("\r"!=k||"\n"!=b){if(h.isEmpty(f)&&(null==n||0==h.len(n.trim())))break;f.add(g.io_CSV.saveMemory(n,c,l));e.add(f);if(0>s)s=f.size();else if(s!=
f.size())throw new h.Exception("Line "+e.size()+" had "+f.size()+" entries; expected "+s);f=new h.List;n=null;l=!1}}else'"'==b?(l=j=!0,null==n&&(n="")):b==p?(f.add(g.io_CSV.saveMemory(n,c,l)),n=null,l=!1):(null==n&&(n=""),n+=b);k=b;m++}b=h.Array(e.size(),null);for(a=0;a<b.length;a++)c=e.get(a),b[a]=c.toArray();return b},findSeparator:function(a){var b,c,e,f,g,j,l=[",","\t","|",";"],m=",",p=-1E5,n=Math.min(5E3,h.len(a));for(c=0;4>c;c++){j=l[c];b=[0,0];for(e=f=0;e<n&&2>f;e++)g=a.charAt(e),g==j&&b[f]++,
"\n"==g&&f++;e=b[0];if(b[0]!=b[1]||0==b[0])e-=1E4;e>p&&(m=j,p=e)}return m},saveMemory:function(a,b,c){if(null==a)return null;c||(a=a.trim());c=b.get(a);return null==c?(b.put(a,a),a):c},makeFields:function(a){var b,c,e,f=h.Array(a[0].length,null);for(c=0;c<f.length;c++){b=h.Array(a.length-1,null);for(e=0;e<b.length;e++)b[e]=a[e+1][c];e=null==a[0][c]?"":a[0][c].toString();f[c]=g.Fields.makeColumnField(g.io_CSV.identifier(e),g.io_CSV.readable(e),b)}return f},identifier:function(a){var b,c,e,f;c=a.indexOf("(");
0<c&&(a=a.substring(0,c).trim());f="";e="X";for(c=0;c<h.len(a);c++)b=a.substring(c,c+1),g.io_CSV.isDigit(b)?0==c&&(f="_"):"_"==b||g.io_CSV.isLower(b)||g.io_CSV.isUpper(b)?"_"==f&&(f=""):b="_","_"==b?"_"!=e&&(f+=b):f+=b,e=b;return 0==h.len(f)?"_":f},readable:function(a){var b,c,e,f,k="",j=" ",l=!1;for(b=0;b<h.len(a);b++)e=a.substring(b,b+1),"_"==e&&(e=" "),c=g.io_CSV.isLower(e),f=g.io_CSV.isUpper(e)," "==e?" "!=j&&(k+=e):k=c?" "==j?k+e.toUpperCase():k+e:l&&(f||g.io_CSV.isDigit(e))?k+(" "+e):k+e,l=
c,j=e;return k},isDigit:function(a){return 0<="0123456789".indexOf(a)},isLower:function(a){return 0<="abcdefghijklmnopqrstuvwxyz".indexOf(a)},isUpper:function(a){return 0<="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(a)}});g.io_Serialize=function(){};g.io_Serialize.DATA_SET=1;g.io_Serialize.FIELD=2;g.io_Serialize.NUMBER=3;g.io_Serialize.STRING=4;g.io_Serialize.DATE=5;g.io_Serialize.VERSION=6;g.io_Serialize.DATASET_VERSION_NUMBER=1;h.copy(g.io_Serialize,{serializeDataset:function(a){var b,c;a=a.removeSpecialFields();
c=new g.io_ByteOutput;c.addByte(g.io_Serialize.VERSION).addNumber(g.io_Serialize.DATASET_VERSION_NUMBER);c.addByte(g.io_Serialize.DATA_SET).addNumber(a.fields.length);a=h.iter(a.fields);for(b=a.current;a.hasNext();b=a.next())g.io_Serialize.addFieldToOutput(b,c);return c.asBytes()},serializeField:function(a){var b=new g.io_ByteOutput;g.io_Serialize.addFieldToOutput(a,b);return b.asBytes()},addFieldToOutput:function(a,b){var c,e,f,k,j=a.rowCount();b.addByte(g.io_Serialize.FIELD).addString(a.name).addString(a.label);
e=new h.Map;f=new h.List;for(c=0;c<j;c++)k=a.value(c),e.containsKey(k)||(e.put(k,e.size()),f.add(k));b.addNumber(f.size());if(a.isDate()){b.addByte(g.io_Serialize.DATE);c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addDate(f)}else if(a.isNumeric()){b.addByte(g.io_Serialize.NUMBER);c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addNumber(f)}else{b.addByte(g.io_Serialize.STRING);c=h.iter(f);for(f=c.current;c.hasNext();f=c.next())b.addString(f)}b.addNumber(j);for(c=0;c<j;c++)b.addNumber(e.get(a.value(c)))},
deserialize:function(a){a=new g.io_ByteInput(a);return g.io_Serialize.readFromByteInput(a)},readFromByteInput:function(a){var b,c,e,f,k,j,l;b=a.readByte();if(b==g.io_Serialize.FIELD){l=a.readString();k=a.readString();j=a.readNumber();b=a.readByte();f=h.Array(j,null);for(c=0;c<j;c++)if(b==g.io_Serialize.NUMBER)f[c]=a.readNumber();else if(b==g.io_Serialize.STRING)f[c]=a.readString();else if(b==g.io_Serialize.DATE)f[c]=a.readDate();else throw new h.Exception("Unknown column type "+b);j=a.readNumber();
e=h.Array(j,0);for(c=0;c<j;c++)e[c]=a.readNumber();a=g.Fields.permute(g.Fields.makeColumnField(l,k,f),e,!1);(b==g.io_Serialize.NUMBER||b==g.io_Serialize.DATE)&&a.setNumeric();b==g.io_Serialize.DATE&&a.set("date",!0);return a}if(b==g.io_Serialize.DATA_SET){j=a.readNumber();b=h.Array(j,null);for(c=0;c<j;c++)b[c]=g.io_Serialize.readFromByteInput(a);return g.Dataset.make(b,!1)}if(b==g.io_Serialize.VERSION){c=a.readNumber();if(c!=g.io_Serialize.DATASET_VERSION_NUMBER)throw new h.Exception("Serialized version differs from current execution version");
return g.io_Serialize.readFromByteInput(a)}throw new h.Exception("Unknown class: "+b);}});g.modify_DataOperation=function(){};h.copy(g.modify_DataOperation,{map:function(a){var b,c=new h.List;a=h.iter(g.modify_DataOperation.strings(a,";"));for(b=a.current;a.hasNext();b=a.next())c.add(g.modify_DataOperation.strings(b,"="));return c},strings:function(a,b){var c,e=g.Data.split(a,b);for(c=0;c<e.length;c++)e[c]=e[c].trim();return 1==e.length&&h.isEmpty(e[0])?h.Array(0,null):e}});g.modify_AddConstantFields=
function(){h.superconstruct(this)};h.extend(g.modify_AddConstantFields,g.modify_DataOperation);h.copy(g.modify_AddConstantFields,{transform:function(a,b){var c,e,f,k=g.modify_DataOperation.strings(b,";");if(0==k.length)return a;c=h.Array(a.fields.length+k.length,null);for(e=0;e<k.length;e++)f=k[e],c[e]=g.Data.isQuoted(f)?g.Fields.makeConstantField(f,g.Data.deQuote(f),g.Data.deQuote(f),a.rowCount()):g.Fields.makeConstantField(f,f,g.Data.asNumeric(f),a.rowCount());for(e=0;e<a.fields.length;e++)c[e+
k.length]=a.fields[e];return a.replaceFields(c)}});g.modify_AllCombinations=function(a,b,c){this.fields=a;this.xCount=b;this.keyLength=b+c;this.index=h.Array(this.keyLength,0);this.categories=this.makeFieldCategories()};h.copy(g.modify_AllCombinations.prototype,{makeFieldCategories:function(){var a,b,c,e=h.Array(this.keyLength,null);for(a=0;a<this.keyLength;a++)if(c=this.fields[a].categories(),a<this.xCount)e[a]=c;else if(a>=this.xCount){e[a]=h.Array(c.length,null);for(b=0;b<c.length;b++)e[a][b]=
c[c.length-1-b]}return e},make:function(){for(var a,b,c=g.modify_Stack.makeStackDataOrder(this.fields,this.keyLength,this.xCount),e=0,f=new h.List;;){b=this.makeKeyRow();for(a=!1;this.matchesCurrent(b,c,e);)a=!0,f.add(this.makeRealRow(c[e++]));a||f.add(b);if(!this.nextIndex())break}a=h.Array(this.fields.length,null);for(b=0;b<this.fields.length;b++)a[b]=g.Fields.makeColumnField(this.fields[b].name,this.fields[b].label,this.extractColumn(f,b)),g.Fields.copyBaseProperties(this.fields[b],a[b]);return a},
extractColumn:function(a,b){var c,e=h.Array(a.size(),null);for(c=0;c<e.length;c++)e[c]=a.get(c)[b];return e},makeKeyRow:function(){var a,b=h.Array(this.fields.length,null);for(a=0;a<this.keyLength;a++)b[a]=this.categories[a][this.index[a]];return b},makeRealRow:function(a){var b,c=h.Array(this.fields.length,null);for(b=0;b<this.fields.length;b++)c[b]=this.fields[b].value(a);return c},matchesCurrent:function(a,b,c){if(c>=b.length)return!1;b=b[c];for(c=0;c<this.keyLength;c++)if(0!=g.Data.compare(a[c],
this.fields[c].value(b)))return!1;return!0},nextIndex:function(){var a;for(a=this.index.length-1;0<=a;a--){if(++this.index[a]<this.categories[a].length)return!0;this.index[a]=0}return!1}});g.modify_ConvertSeries=function(){h.superconstruct(this)};h.extend(g.modify_ConvertSeries,g.modify_DataOperation);h.copy(g.modify_ConvertSeries,{transform:function(a,b){var c,e,f,k,j,l,m,p,n,s;if(h.isEmpty(b))return a;k=g.modify_DataOperation.strings(b,";");n=g.modify_DataOperation.strings(k[0],",");p=n.length;
m=a.rowCount();if(2>p)return a;c=g.modify_ConvertSeries.addRequired(g.modify_DataOperation.strings(2>k.length?"":k[1],","));s=h.Array(p,null);for(j=0;j<p;j++)s[j]=a.field(n[j]);f=h.Array(p*m,0);k=h.Array(p*m,0);e=h.Array(p*m,null);for(j=0;j<p;j++)for(l=0;l<m;l++)f[j*m+l]=j,k[j*m+l]=l,e[j*m+l]=s[j].value(l);m=g.Fields.makeColumnField("#values",g.Data.join(n),e);g.Fields.copyBaseProperties(s[0],m);p=g.Fields.makeColumnField("#series","Series",n);f=g.Fields.permute(p,f,!1);f.setCategories(n);n=new h.List;
n.add(f);n.add(m);c=h.iter(c);for(f=c.current;c.hasNext();f=c.next())"#series"==f||"#values"==f||(f=a.field(f),n.add(g.Fields.permute(f,k,!1)));k=n.toArray();return a.replaceFields(k)},addRequired:function(a){var b=new h.List;h.addAll(b,a);b.contains("#row")||b.add("#row");b.contains("#count")||b.add("#count");return b.toArray()}});g.modify_Each=function(){h.superconstruct(this)};h.extend(g.modify_Each,g.modify_DataOperation);h.copy(g.modify_Each,{transform:function(a,b){var c,e;c=h.iter(g.modify_DataOperation.strings(b,
";"));for(e=c.current;c.hasNext();e=c.next())e=a.field(e),e.isProperty("list")&&(a=g.modify_Each.splitListsInField(a,e));return a},splitListsInField:function(a,b){var c,e,f,k,j;k=new h.List;var l=new h.List;for(f=0;f<b.rowCount();f++)if(e=b.value(f),null==e)l.add(),k.add(f);else for(c=0;c<e.size();c++)l.add(e.get(c)),k.add(f);k=g.Data.toPrimitive(k.toArray());j=h.Array(a.fields.length,null);for(f=0;f<j.length;f++)e=a.fields[f],e==b?(c=l.toArray(),j[f]=g.Fields.makeColumnField(e.name,e.label,c)):j[f]=
g.Fields.permute(e,k,!1);return a.replaceFields(j)}});g.modify_Filter=function(){h.superconstruct(this)};h.extend(g.modify_Filter,g.modify_DataOperation);h.copy(g.modify_Filter,{transform:function(a,b){var c,e,f,k,j,l,m,p=g.modify_DataOperation.strings(b,";"),n=p.length;if(0==n)return a;e=h.Array(n,null);m=h.Array(n,0);j=h.Array(n,null);for(f=0;f<n;f++){c=p[f].trim();k=c.indexOf(" ");l=c.indexOf(" ",k+1);0>l&&(l=h.len(c));e[f]=a.field(c.substring(0,k).trim());k=g.modify_Filter.getType(c.substring(k,
l).trim());c=g.modify_Filter.getParams(c.substring(l).trim(),e[f].preferCategorical());if(4==k||-4==k)c=g.modify_Filter.getRankedObjects(e[f],g.Data.asNumeric(c[0]),g.Data.asNumeric(c[1])),k=0>k?-3:3;m[f]=k;j[f]=c}e=g.modify_Filter.makeRowsToKeep(e,m,j);return null==e?a:a.retainRows(e)},getRankedObjects:function(a,b,c){var e,f,k=new h.List,j=a.rowCount();for(e=0;e<j;e++)f=a.value(e),null!=f&&k.add(f);e=k.toArray();g.Data.sort(e);a=e.length;b=Math.min(Math.max(1,Math.floor(b)),a);c=Math.min(Math.max(1,
Math.floor(c)),a);return[e[a-c],e[a-b]]},getType:function(a){if(h.startsWith(a,"!"))return-g.modify_Filter.getType(a.substring(1).trim());if("valid"==a)return 1;if("is"==a)return 2;if("in"==a)return 3;if("ranked"==a)return 4;throw new h.Exception("Cannot use filter command "+a);},getParams:function(a,b){var c,e=a.split(","),f=h.Array(e.length,null);for(c=0;c<f.length;c++)f[c]=b?e[c].trim():g.Data.asNumeric(e[c].trim());return f},makeRowsToKeep:function(a,b,c){var e,f,k,j,l,m,p=new h.List,n=a[0].rowCount();
for(j=0;j<n;j++){e=!1;for(f=0;f<a.length;f++){m=a[f].value(j);if(null==m){e=!0;break}l=b[f];k=c[f];if(2==l||-2==l)e=!g.modify_Filter.matchAny(m,k);else if(3==l||-3==l)e=0>g.Data.compare(m,k[0])||0<g.Data.compare(m,k[1]);0>l&&(e=!e);if(e)break}e||p.add(j)}if(p.size()==n)return null;a=h.Array(p.size(),0);for(f=0;f<a.length;f++)a[f]=p.get(f);return a},matchAny:function(a,b){var c,e;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())if(0==g.Data.compare(a,e))return!0;return!1}});g.modify_Sort=function(){h.superconstruct(this)};
h.extend(g.modify_Sort,g.modify_DataOperation);h.copy(g.modify_Sort,{transform:function(a,b,c){var e,f,k,j,l;e=g.modify_DataOperation.strings(b,";");if(0==e.length)return a;b=g.modify_Sort.getFields(a,e);e=g.modify_Sort.getAscending(b,e);l=(new g.summary_FieldRowComparison(b,e,!0)).makeSortedOrder();for(j=a.fields.length-1;0<=j;j--)f=a.fields[j],f.isBinned()&&f.preferCategorical()&&(l=g.modify_Sort.moveCatchAllToEnd(l,f));f=h.Array(a.fields.length,null);for(j=0;j<f.length;j++)k=a.fields[j],f[j]=g.Fields.permute(k,
l,!0),!k.ordered()&&c&&(k=g.modify_Sort.makeOrder(k,b,e),f[j].setCategories(k));return a.replaceFields(f)},makeOrder:function(a,b,c){var e,f,k,j,l,m=new h.Map;for(k=0;k<a.rowCount();k++)e=a.value(k),null!=e&&(l=m.get(e),null==l&&(l=new h.List,m.put(e,l)),l.add(k));a=a.categories();e=a.length;f=h.Array(b.length,e,null);for(j=0;j<e;j++){l=m.get(a[j]);for(k=0;k<b.length;k++)f[k][j]=b[k].isNumeric()?g.modify_Sort.sum(b[k],l):g.modify_Sort.mode(b[k],l)}l=h.Array(b.length,null);for(k=0;k<b.length;k++)l[k]=
g.Fields.makeColumnField("",null,f[k]),b[k].isNumeric()&&l[k].setNumeric();b=(new g.summary_FieldRowComparison(l,c,!0)).makeSortedOrder();c=h.Array(e,null);for(k=0;k<e;k++)c[k]=a[b[k]];return c},sum:function(a,b){var c,e,f=0;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())e=g.Data.asNumeric(a.value(e)),null!=e&&(f+=e);return f},mode:function(a,b){var c,e,f=new g.util_MapInt;c=h.iter(b);for(e=c.current;c.hasNext();e=c.next())f.increment(a.value(e));return f.mode()},makeRowRanking:function(a,b){for(var c,
e,f=h.Array(a.length,0),g=0;g<a.length;){for(c=g+1;c<a.length&&0==b.compare(a[g],a[c]);)c++;for(e=(c+g+1)/2;g<c;)f[a[g++]]=e}return f},getFields:function(a,b){var c,e,f=h.Array(b.length,null);for(c=0;c<f.length;c++)if(e=b[c].split(":")[0],f[c]=a.field(e.trim()),null==f[c])throw new h.Exception("Could not find field: "+e);return f},getAscending:function(a,b){var c,e,f=h.Array(a.length,!1);for(c=0;c<f.length;c++)if(e=b[c].split(":"),1<e.length)if(e=e[1].trim(),h.equalsIgnoreCase(e,"ascending"))f[c]=
!0;else if(h.equalsIgnoreCase(e,"descending"))f[c]=!1;else throw new h.Exception("Sort options must be 'ascending' or 'descending'");else f[c]=a[c].isDate()||!a[c].isNumeric();return f},moveCatchAllToEnd:function(a,b){var c,e,f=h.Array(a.length,0),g=new h.List,j=0;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())"…"==b.value(e)?g.add(e):f[j++]=e;c=h.iter(g);for(e=c.current;c.hasNext();e=c.next())f[j++]=e;return f},categoriesFromRanks:function(a,b){var c,e,f,k;k=a.rowCount();var j=a.categories(),
l=a.property("categoryCounts"),m=h.Array(l.length,0);for(e=0;e<m.length;e++)m[e]=e/100/m.length;c=(new g.util_MapInt).index(j);for(e=0;e<k;e++)f=a.value(e),null!=f&&(f=c.get(f),m[f]+=b[e]/l[f]);k=g.Data.order(m,!0);c=h.Array(k.length,null);for(e=0;e<k.length;e++)c[e]=j[k[e]];return c}});g.modify_Stack=function(){h.superconstruct(this)};h.extend(g.modify_Stack,g.modify_DataOperation);h.copy(g.modify_Stack,{transform:function(a,b){var c,e,f,k,j;if(h.isEmpty(b))return a;f=g.modify_DataOperation.strings(b,
";");j=f[0];k=g.modify_DataOperation.strings(f[1],",");c=g.modify_DataOperation.strings(f[2],",");f=h.equalsIgnoreCase(f[3],"true");e=g.modify_Stack.getFields(a.fields,k,c,[j]);e=g.modify_Stack.makeStackOrderedFields(a,e,k.length);f&&(e=(new g.modify_AllCombinations(e,k.length,c.length)).make());c=g.modify_Stack.makeStackedValues(e,g.modify_Stack.getField(e,j),g.modify_Stack.getFields(e,k),f);return a.replaceFields(c)},getField:function(a,b){var c,e;c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())if(h.equals(e.name,
b))return e;throw new h.Exception("Could not find field: "+b);},getFields:function(a){var b=Array.prototype.slice.call(arguments,1),c,e,f=new h.List,k=new h.Set,b=h.iter(b);for(c=b.current;b.hasNext();c=b.next()){c=h.iter(c);for(e=c.current;c.hasNext();e=c.next())e=e.trim(),h.isEmpty(e)||(e=g.modify_Stack.getField(a,e),k.add(e)&&f.add(e))}return f.toArray()},makeStackedValues:function(a,b,c,e){var f,k;f=b.rowCount();var j=h.Array(2,f,null),l=0,m=0,p=new g.summary_FieldRowComparison(c,null,!1);for(c=
0;c<f;c++){k=g.Data.asNumeric(b.value(c));if(null==k)if(e)k=0;else continue;0<c&&0!=p.compare(c,c-1)&&(m=l=0);0>k?(j[0][c]=m,m+=k,j[1][c]=m):(j[0][c]=l,l+=k,j[1][c]=l)}f=a.length;e=h.Array(f+2,null);for(c=0;c<f;c++)e[c]=a[c];e[f]=g.Fields.makeColumnField(b.name+"$lower",b.label,j[0]);e[f+1]=g.Fields.makeColumnField(b.name+"$upper",b.label,j[1]);g.Fields.copyBaseProperties(b,e[f]);g.Fields.copyBaseProperties(b,e[f+1]);h.sort(e);return e},makeStackOrderedFields:function(a,b,c){a=g.modify_Stack.orderFields(a,
b);c=g.modify_Stack.makeStackDataOrder(a,b.length,c);var e=h.Array(a.length,null);for(b=0;b<a.length;b++)e[b]=g.Fields.permute(a[b],g.Data.toPrimitive(c),!0);return e},makeStackDataOrder:function(a,b,c){var e,f,k,j=new h.List,l=a[0].rowCount();for(e=0;e<l;e++){k=!0;for(f=0;f<b;f++)null==a[f].value(e)&&(k=!1);k&&j.add(e)}b=h.Array(b,!1);for(e=0;e<b.length;e++)b[e]=e<c;a=new g.summary_FieldRowComparison(a,b,!0);h.sort(j,a);return j.toArray()},orderFields:function(a,b){var c,e,f,g=h.Array(a.fields.length,
null),j=new h.Set;for(c=0;c<b.length;c++)g[c]=b[c],j.add(b[c]);e=b.length;c=h.iter(a.fields);for(f=c.current;c.hasNext();f=c.next())j.contains(f)||(g[e++]=f);return g}});g.modify_Summarize=function(a,b,c,e){h.superconstruct(this);this.measures=a;this.dimensions=b;this.percentBase=c;this.rowCount=e;b=!1;a=h.iter(a);for(c=a.current;a.hasNext();c=a.next())c.isPercent()&&(b=!0);this.percentNeeded=b};h.extend(g.modify_Summarize,g.modify_DataOperation);h.copy(g.modify_Summarize,{transform:function(a,b){var c,
e,f,k,j,l,m,p,n;if(0==a.rowCount())return a;c=g.modify_DataOperation.map(b);if(h.isEmpty(c))return a;l=new h.List;j=new h.List;p=new h.List;k=f=!1;c=h.iter(c);for(m=c.current;c.hasNext();m=c.next())"#count"==m[0]&&(f=!0),"#row"==m[0]&&(k=!0),n=m[1].split(":"),e=a.field(n[0].trim()),1==n.length?j.add(new g.summary_DimensionField(e,m[0])):"base"==n[1].trim()?(j.add(new g.summary_DimensionField(e,m[0])),p.add(e)):(e=new g.summary_MeasureField(e,m[0],n[1].trim()),2<n.length&&(e.option=n[2].trim()),l.add(e));
h.sort(l);h.sort(j);f||l.add(new g.summary_MeasureField(a.field("#count"),"#count","sum"));k||l.add(new g.summary_MeasureField(a.field("#row"),"#row","list"));f=(new g.modify_Summarize(l,j,p,a.rowCount())).make();return a.replaceFields(f)}});h.copy(g.modify_Summarize.prototype,{make:function(){var a,b,c,e,f,k,j,l,m,p;c=this.getFields(this.dimensions);e=this.percentBase.toArray();a=this.getFields(this.measures);b=new g.summary_FieldRowComparison(c,null,!1);f=new g.summary_FieldRowComparison(e,null,
!1);j=h.Array(this.rowCount,0);b=this.buildGroups(j,b);k=this.percentNeeded?h.Array(this.rowCount,0):null;l=this.percentNeeded?this.buildGroups(k,f):0;var n=h.Array(b,null);for(f=0;f<n.length;f++)n[f]=new g.summary_SummaryValues(a,e,c);e=h.Array(l,a.length,0);for(l=0;l<this.rowCount;l++){p=n[j[l]];if(this.percentNeeded){null==p.percentSums&&(p.percentSums=e[k[l]]);for(f=0;f<a.length;f++)this.measures.get(f).isPercent()&&(m=g.Data.asNumeric(a[f].value(l)),null!=m&&(p.percentSums[f]+=m))}p.rows.add(l)}a=
h.Array(this.dimensions.size(),b,null);j=h.Array(this.measures.size(),b,null);for(e=0;e<b;e++){l=n[e];k=l.firstRow();for(f=0;f<this.dimensions.size();f++)a[f][e]=c[f].value(k);for(f=0;f<this.measures.size();f++)k=this.measures.get(f),j[f][e]=l.get(f,k)}c=h.Array(a.length+j.length,null);for(f=0;f<a.length;f++)b=this.dimensions.get(f),c[f]=g.Fields.makeColumnField(b.rename,b.label(),a[f]),g.Fields.copyBaseProperties(b.field,c[f]);for(f=0;f<j.length;f++)k=this.measures.get(f),b=g.Fields.makeColumnField(k.rename,
k.label(),j[f]),this.setProperties(k.method,b,k.field),b.set("summary",k.method),b.set("calculated",!0),null!=k.field&&b.set("originalLabel",k.field.label),c[a.length+f]=b;return c},setProperties:function(a,b,c){"list"==a?(b.copyProperties(c,"dateFormat"),b.set("list",!0)):"count"==a||"percent"==a||"valid"==a||"unique"==a?b.setNumeric():g.Fields.copyBaseProperties(c,b)},getFields:function(a){var b,c=h.Array(a.size(),null);for(b=0;b<c.length;b++)c[b]=a.get(b).field;return c},buildGroups:function(a,
b){var c,e,f;if(h.isEmpty(b))return 1;f=b.makeSortedOrder();for(e=c=0;e<a.length;e++)0<e&&0!=b.compare(f[e],f[e-1])&&c++,a[f[e]]=c;return c+1}});g.modify_Transform=function(){h.superconstruct(this)};h.extend(g.modify_Transform,g.modify_DataOperation);h.copy(g.modify_Transform,{transform:function(a,b){var c,e,f,k,j,l;if(0==a.rowCount())return a;l=g.modify_DataOperation.map(b);if(h.isEmpty(l))return a;e=h.Array(a.fields.length,null);for(f=0;f<e.length;f++){j=null;c=h.iter(l);for(k=c.current;c.hasNext();k=
c.next())h.equals(k[0],a.fields[f].name)&&(j=k[1]);e[f]=g.modify_Transform.modify(a.fields[f],j);e[f].set("summary",j)}return a.replaceFields(e)},makeKey:function(a,b){var c,e,f="|";c=h.iter(a);for(e=c.current;c.hasNext();e=c.next())f+=e.value(b)+"|";return f},modify:function(a,b){var c,e;if(null==b)return a;e=b.split(":");c=e[0].trim();e=1<e.length?e[1].trim():null;return"bin"==c?(c=null==e?-1:Number(e),g.modify_Transform.bin(a,c)):"rank"==c?g.modify_Transform.rank(a,"ascending"==e):a},rank:function(a,
b){for(var c,e,f=a.rowCount(),k=(new g.summary_FieldRowComparison([a],[b],!0)).makeSortedOrder(),j=h.Array(f,null),l=0;l<f;){c=k[l];for(e=l+1;e<f&&0==a.compareRows(c,k[e]);)e++;for(c=l;c<e;c++)j[k[c]]=(l+e+1)/2;l=e}e=g.Fields.makeColumnField(a.name,a.label,j);e.setNumeric();return e},bin:function(a,b){var c=a.preferCategorical()?g.modify_Transform.binCategorical(a,b):g.modify_Transform.binNumeric(a,b);c.set("binned",!0);return c},binCategorical:function(a,b){var c,e,f,k;1>b&&(b=7);c=a.categories();
if(c.length<=b)return a;k=g.Data.order(a.property("categoryCounts"),!1);f=new h.Map;for(e=0;e<k.length;e++)f.put(c[k[e]],e<b-1?c[k[e]]:"…");c=h.Array(a.rowCount(),null);for(e=0;e<c.length;e++)c[e]=f.get(a.value(e));return g.Fields.makeColumnField(a.name,a.label,c)},binNumeric:function(a,b){var c=g.auto_Auto.makeNumericScale(a,!0,[0,0],0,b+1,!0),e=c.divisions,f=a.isDate()?a.property("dateFormat"):null,c=g.modify_Transform.makeBinRanges(e,f,c.granular),e=g.modify_Transform.binData(a,e,c),e=g.Fields.makeColumnField(a.name,
a.label,e);a.isDate()&&e.set("date",!0);e.setNumeric();e.set("categories",c);e.set("transform",a.property("transform"));return e},makeBinRanges:function(a,b,c){var e,f,k,j=h.Array(a.length-1,null);for(k=0;k<j.length;k++)e=a[k],f=a[k+1],j[k]=null==b?g.util_Range.makeNumeric(e,f,c):g.util_Range.makeDate(e,f,c,b);return j},binData:function(a,b,c){var e,f,k=h.Array(a.rowCount(),null);for(f=0;f<k.length;f++)e=g.Data.asNumeric(a.value(f)),null!=e&&(e=g.Data.indexOf(e,b),k[f]=c[Math.min(e,c.length-1)]);
return k}});g.stats_DateStats=function(){};h.copy(g.stats_DateStats,{populate:function(a){var b,c,e;b=a.max()-a.min();0==b&&(b=a.max());e=g.stats_DateStats.getUnit(b);a.set("dateUnit",e);c=a.numProperty("granularity");b=Math.min(1,Math.sqrt(a.valid())/7);a.set("dateFormat",g.stats_DateStats.getFormat(e,c*b))},getUnit:function(a){var b,c;b=h.iter(g.util_DateUnit.values());for(c=b.current;b.hasNext();c=b.next())if(a>3.5*c.approxDaysPerUnit||c==g.util_DateUnit.day&&a>=2.5*c.approxDaysPerUnit)return c;
return g.util_DateUnit.second},getFormat:function(a,b){return 360<b?g.util_DateFormat.Year:13<b?g.util_DateFormat.YearMonth:0.9<b?g.util_DateFormat.YearMonthDay:a.ordinal()<g.util_DateUnit.hour.ordinal()?g.util_DateFormat.DayHour:6.25E-4<b?g.util_DateFormat.HourMin:g.util_DateFormat.HourMinSec},creates:function(a){return"dateUnit"==a||"dateFormat"==a}});g.stats_NominalStats=function(){};h.copy(g.stats_NominalStats,{populate:function(a){var b,c=new g.util_MapInt,e=a.rowCount();for(b=0;b<e;b++)c.increment(a.value(b));
a.set("n",e);a.set("unique",c.size());a.set("valid",c.getTotalCount());a.set("mode",c.mode());a.isProperty("categoriesOrdered")?b=a.categories():(b="#selection"==a.name?[g.Field.VAL_UNSELECTED,g.Field.VAL_SELECTED]:c.sortedKeys(),a.set("categories",b));a.set("categoryCounts",c.getCounts(b))},creates:function(a){return"n"==a||"mode"==a||"unique"==a||"valid"==a||"categories"==a||"categoryCounts"==a}});g.stats_NumericStats=function(){};h.copy(g.stats_NumericStats,{populate:function(a){var b,c,e,f,k,
j;j=a.rowCount();c=new h.List;for(f=0;f<j;f++)e=a.value(f),null!=e&&(e instanceof g.util_Range?(b=e.low,e=e.high,c.add(g.Data.asNumeric(b)),c.add(g.Data.asNumeric(e))):(b=g.Data.asNumeric(e),null!=b&&c.add(b)));c=c.toArray();j=c.length;a.set("validNumeric",j);if(0!=j){f=g.stats_NumericStats.moment(c,0,1,j);b=g.stats_NumericStats.moment(c,f,2,j-1);e=g.stats_NumericStats.moment(c,f,3,j-1);k=g.stats_NumericStats.moment(c,f,4,j-1);a.set("mean",f);a.set("stddev",Math.sqrt(b));a.set("variance",b);a.set("skew",
e/b/Math.sqrt(b));a.set("kurtosis",k/b/b-3);h.sort(c);b=c[0];f=c[j-1];a.set("min",b);a.set("max",f);a.set("median",g.stats_NumericStats.av(c,0.5*(j-1)));0==j%2?(a.set("q1",g.stats_NumericStats.av(c,0.5*(j/2-1))),a.set("q3",g.stats_NumericStats.av(c,j/2+0.5*(j/2-1)))):(a.set("q1",g.stats_NumericStats.av(c,0.25*(j-1))),a.set("q3",g.stats_NumericStats.av(c,(j-1)/2+0.25*(j-1))));j=f-b;0==j&&(j=Math.abs(f));for(f=1;f<c.length;f++)b=c[f]-c[f-1],0<b&&(j=Math.min(j,b));a.set("granularity",j)}},moment:function(a,
b,c,e){var f,g;if(0>=e)return Number.NaN;g=0;a=h.iter(a);for(f=a.current;a.hasNext();f=a.next())g+=Math.pow(f-b,c);return g/e},av:function(a,b){return(a[Math.floor(b)]+a[Math.ceil(b)])/2},creates:function(a){return"validNumeric"==a||"mean"==a||"stddev"==a||"variance"==a||"skew"==a||"kurtosis"==a||"min"==a||"max"==a||"q1"==a||"q3"==a||"median"==a||"granularity"==a}});g.summary_DimensionField=function(a,b){this.field=a;this.rename=null==b?a.name:b};h.copy(g.summary_DimensionField.prototype,{compareTo:function(a){return g.Data.compare(this.rename,
a.rename)},getDateFormat:function(){return this.isDate()?this.field.property("dateFormat"):null},isDate:function(){return null!=this.field&&this.field.isDate()},label:function(){return null==this.field?this.rename:this.field.label}});g.summary_FieldRowComparison=function(a,b,c){this.fields=a;this.ascending=b;this.rowsBreakTies=c;this.n=null==b?a.length:b.length};h.copy(g.summary_FieldRowComparison.prototype,{compare:function(a,b){var c,e;for(c=0;c<this.n;c++)if(e=this.fields[c].compareRows(a,b),0!=
e)return null!=this.ascending&&!this.ascending[c]?-e:e;return this.rowsBreakTies?a-b:0},isEmpty:function(){return 0==this.fields.length},makeSortedOrder:function(){var a,b=this.fields[0].rowCount(),c=h.Array(b,0);for(a=0;a<b;a++)c[a]=a;h.sort(c,this);return g.Data.toPrimitive(c)}});g.summary_Fit=function(a,b,c){var e,f,k,j;this.fx=b;this.fy=a;this.xCatMap=this.makeCatMap(b);this.yCatMap=this.makeCatMap(a);f=new h.List;j=new h.List;e=h.iter(c);for(c=e.current;e.hasNext();c=e.next())k=this.vx(b.value(c)),
c=this.vy(a.value(c)),null!=k&&null!=c&&(f.add(k),j.add(c));a=f.size();b=g.Data.order(f.toArray(),!0);this.x=h.Array(a,0);this.y=h.Array(a,0);for(c=0;c<a;c++)this.x[c]=f.get(b[c]),this.y[c]=j.get(b[c]);this.my=g.summary_Fit.mean(this.y);this.mx=g.summary_Fit.mean(this.x)};h.copy(g.summary_Fit,{mean:function(a){var b,c,e=0;b=h.iter(a);for(c=b.current;b.hasNext();c=b.next())e+=c;return e/a.length}});h.copy(g.summary_Fit.prototype,{makeCatMap:function(a){var b,c;if(a.isNumeric())return null;c=new h.Map;
a=a.categories();for(b=0;b<a.length;b++)c.put(a[b],b);return c},vx:function(a){return null==this.xCatMap?g.Data.asNumeric(a):this.xCatMap.get(a)},vy:function(a){return null==this.yCatMap?g.Data.asNumeric(a):this.yCatMap.get(a)},reverseY:function(a){var b;if(null==this.yCatMap)return a;b=Math.round(a);a=this.fy.categories();return 0>b||b>=a.length?null:a[b]}});g.summary_MeasureField=function(a,b,c){this.option=null;this.fits=new h.Map;h.superconstruct(this,a,null==b&&null==a?c:b);this.method=null!=
a&&"mean"==c&&!a.isNumeric()?"mode":c};h.extend(g.summary_MeasureField,g.summary_DimensionField);h.copy(g.summary_MeasureField.prototype,{getFit:function(a,b){return this.fits.get(g.modify_Transform.makeKey(a,b))},setFit:function(a,b,c){this.fits.put(g.modify_Transform.makeKey(a,b),c)},isPercent:function(){return"percent"==this.method},label:function(){var a,b;if("list"==this.method)return this.field.label;if("count"==this.method)return"Count";if(null==this.field||"#count"==this.field.name){if("sum"==
this.method)return this.field.label;if("percent"==this.method)return"Percent"}a=this.method.substring(0,1).toUpperCase();b=this.method.substring(1);return a+b+"("+this.field.label+")"}});g.summary_Regression=function(a,b,c){var e;h.superconstruct(this,a,b,c);b=this.x.length;for(a=c=e=0;a<b;a++)e+=(this.x[a]-this.mx)*(this.y[a]-this.my),c+=(this.x[a]-this.mx)*(this.x[a]-this.mx);this.m=0==c?0:e/c;this.b=this.my-this.m*this.mx};h.extend(g.summary_Regression,g.summary_Fit);h.copy(g.summary_Regression.prototype,
{get:function(a){return null==this.m||null==a?null:this.reverseY(this.m*this.vx(a)+this.b)}});g.summary_Smooth=function(a,b,c,e){h.superconstruct(this,a,b,e);this.window=this.getWindowWidth(b,c)};h.extend(g.summary_Smooth,g.summary_Fit);h.copy(g.summary_Smooth.prototype,{getWindowWidth:function(a,b){var c,e,f;a.isNumeric()?(e=a.min(),f=a.max()):(e=0,f=a.categories().length-1);if(null!=b)return(f-e)*b/200;c=g.auto_Auto.optimalBinCount(a);return(f-e)/c},get:function(a){a=this.vx(a);return null==a?null:
this.reverseY(this.eval(a,this.window))},eval:function(a,b){var c,e;e=this.search(a-b,this.x);for(var f=this.search(a+b,this.x),g=0,h=0;e<=f;e++)c=(this.x[e]-a)/b,c=0.75*(1-c*c),1E-5<c&&(h+=c,g+=c*this.y[e]);return 1E-4>h?b<10*this.window?this.eval(a,2*b):this.my:g/h},search:function(a,b){for(var c,e=0,f=b.length-1;1<f-e;)c=e+f>>1,b[c]<=a&&(e=c),b[c]>=a&&(f=c);for(;0<e&&b[e-1]==a;)e--;for(;f<b.length-1&&b[f+1]==a;)f++;return e+f>>1}});g.summary_SummaryValues=function(a,b,c){var e,f,g;this.rows=new h.List;
this.percentSums=null;this.fields=a;this.xFields=b;this.groupFields=new h.List;a=h.iter(c);for(e=a.current;a.hasNext();e=a.next()){f=!0;c=h.iter(b);for(g=c.current;c.hasNext();g=c.next())g==e&&(f=!1);f&&this.groupFields.add(e)}};h.copy(g.summary_SummaryValues.prototype,{firstRow:function(){return this.rows.get(0)},get:function(a,b){var c,e,f;c=b.method;if("count"==c)return this.rows.size();f=0==this.xFields.length?null:this.xFields[this.xFields.length-1];e=this.rows.get(0);if("fit"==c)return c=b.getFit(this.groupFields,
e),null==c&&(c=new g.summary_Regression(b.field,f,this.validForGroup(e))),b.setFit(this.groupFields,e,c),c.get(f.value(e));if("smooth"==c)return c=b.getFit(this.groupFields,e),null==c&&(c=null,null!=b.option&&(c=Number(b.option)),c=new g.summary_Smooth(b.field,f,c,this.validForGroup(e))),b.setFit(this.groupFields,e,c),c.get(f.value(this.rows.get(0)));e=h.Array(this.rows.size(),null);for(f=0;f<e.length;f++)e[f]=this.fields[a].value(this.rows.get(f));e=g.Fields.makeColumnField("temp",null,e);f=e.numProperty("mean");
if("percent"==c){if(null==f)return null;c="overall"==b.option?b.field.valid()*b.field.numProperty("mean"):this.percentSums[a];return 0<c?100*f*e.valid()/c:null}return"range"==c?this.makeRange(b,e,"min","max"):"iqr"==c?this.makeRange(b,e,"q1","q3"):"sum"==c?null==f?null:f*e.numProperty("valid"):"list"==c?(c=new g.util_ItemsList(e.property("categories")),null!=b.option&&(e=Number(b.option),c.setDisplayCount(e)),c):e.property(c)},makeRange:function(a,b,c,e){return g.util_Range.make(b.numProperty(c),
b.numProperty(e),a.getDateFormat())},validForGroup:function(a){var b,c,e,f,g=new h.List,j=this.fields[0].rowCount();for(e=0;e<j;e++){f=!0;b=h.iter(this.groupFields);for(c=b.current;b.hasNext();c=b.next())0!=c.compareRows(a,e)&&(f=!1);f&&g.add(e)}return g}});g.util_DateFormat=function(){};h.copy(g.util_DateFormat.prototype,{format:function(a){a=a.toUTCString().split(" ");var b=this.toString();if("HourMinSec"==b)return a[4];if("Year"==b)return a[3];if("YearMonth"==b)return a[2]+" "+Number(a[3]);if("YearMonthDay"==
b)return a[2]+" "+Number(a[1])+", "+Number(a[3]);var c=a[4].split(":"),c=c[0]+":"+c[1];return"HourMin"==b?c:a[2]+" "+Number(a[1])+" "+c}});g.util_DateFormat.HourMinSec=new g.util_DateFormat;g.util_DateFormat.HourMin=new g.util_DateFormat;g.util_DateFormat.DayHour=new g.util_DateFormat;g.util_DateFormat.YearMonthDay=new g.util_DateFormat;g.util_DateFormat.YearMonth=new g.util_DateFormat;g.util_DateFormat.Year=new g.util_DateFormat;h.extendEnum(g.util_DateFormat);g.util_DateUnit=function(a,b){this.approxDaysPerUnit=
a;this.base=b};h.copy(g.util_DateUnit,{floor:function(a,b,c){if(b==g.util_DateUnit.day)return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),g.util_DateUnit.floorNumeric(a.getUTCDate(),c,1)));if(b==g.util_DateUnit.week)return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),g.util_DateUnit.floorNumeric(a.getUTCDate(),7*c,1)));if(b==g.util_DateUnit.month)return new Date(Date.UTC(a.getUTCFullYear(),g.util_DateUnit.floorNumeric(a.getUTCMonth(),c,0)));if(b==g.util_DateUnit.quarter)return new Date(Date.UTC(a.getUTCFullYear(),
g.util_DateUnit.floorNumeric(a.getUTCMonth(),3*c,0)));if(b==g.util_DateUnit.year)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),c,0),0));if(b==g.util_DateUnit.decade)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),10*c,0),0));if(b==g.util_DateUnit.century)return new Date(Date.UTC(g.util_DateUnit.floorNumeric(a.getUTCFullYear(),100*c,0),0));var e=new Date(a.getTime());if(b==g.util_DateUnit.second)e.setUTCSeconds(g.util_DateUnit.floorNumeric(a.getUTCSeconds(),
c,0));else if(b==g.util_DateUnit.minute)e.setUTCSeconds(0),e.setUTCMinutes(g.util_DateUnit.floorNumeric(a.getUTCMinutes(),c,0));else if(b==g.util_DateUnit.hour)e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(g.util_DateUnit.floorNumeric(a.getUTCHours(),c,0));else if(b==g.util_DateUnit.hour)e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(g.util_DateUnit.floorNumeric(a.getUTCHours(),c,0));else throw"Invalid date unit "+b;return e},floorNumeric:function(a,b,c){return b*Math.floor((a-c)/b)+c},
increment:function(a,b,c){a=new Date(a.getTime());b==g.util_DateUnit.second?a.setUTCSeconds(a.getUTCSeconds()+c):b==g.util_DateUnit.minute?a.setUTCMinutes(a.getUTCMinutes()+c):b==g.util_DateUnit.hour?a.setUTCHours(a.getUTCHours()+c):b==g.util_DateUnit.day?a.setUTCDate(a.getUTCDate()+c):b==g.util_DateUnit.week?a.setUTCDate(a.getUTCDate()+7*c):b==g.util_DateUnit.month?a.setUTCMonth(a.getUTCMonth()+c):b==g.util_DateUnit.quarter?a.setUTCMonth(a.getUTCMonth()+3*c):b==g.util_DateUnit.year?a.setUTCFullYear(a.getUTCFullYear()+
c):b==g.util_DateUnit.decade?a.setUTCFullYear(a.getUTCFullYear()+10*c):b==g.util_DateUnit.century&&a.setUTCFullYear(a.getUTCFullYear()+100*c);return a}});g.util_DateUnit.century=new g.util_DateUnit(36500,10);g.util_DateUnit.decade=new g.util_DateUnit(3650,10);g.util_DateUnit.year=new g.util_DateUnit(365,10);g.util_DateUnit.quarter=new g.util_DateUnit(91.25,4);g.util_DateUnit.month=new g.util_DateUnit(30,4);g.util_DateUnit.week=new g.util_DateUnit(7,4);g.util_DateUnit.day=new g.util_DateUnit(1,7);
g.util_DateUnit.hour=new g.util_DateUnit(1/24,24);g.util_DateUnit.minute=new g.util_DateUnit(1/24/60,60);g.util_DateUnit.second=new g.util_DateUnit(1/24/3600,60);h.extendEnum(g.util_DateUnit);g.util_ItemsList=function(a){this.displayCount=12;this.items=a};h.copy(g.util_ItemsList.prototype,{equals:function(a){return this==a||a instanceof g.util_ItemsList&&0==this.compareTo(a)},hashCode:function(){var a,b,c=1;a=h.iter(this.items);for(b=a.current;a.hasNext();b=a.next())c=31*c+(null==b?0:h.hash(b));return c},
compareTo:function(a){var b,c,e=Math.min(this.size(),a.size());for(c=0;c<e;c++)if(b=g.Data.compare(this.get(c),a.get(c)),0!=b)return b;return this.size()-a.size()},get:function(a){return this.items[a]},size:function(){return this.items.length},setDisplayCount:function(a){this.displayCount=a},toString:function(a){var b,c,e,f="",h=this.size();for(c=0;c<h;c++){0<c&&(f+=", ");if(c==this.displayCount-1&&h>this.displayCount)return f+"…";e=this.get(c);null!=a?(e=a.format(g.Data.asDate(e)),b=e.indexOf(","),
0<b?(f+=e.substring(0,b),f+=e.substring(b+1)):f+=e):(b=g.Data.asNumeric(e),f=null!=b?f+g.Data.formatNumeric(b,!1):f+e.toString())}return f}});g.util_MapInt=function(){this.map=new h.Map;this.maxCount=this.totalCount=0};h.copy(g.util_MapInt.prototype,{get:function(a){a=this.map.get(a);return null==a?0:a},getCounts:function(a){var b,c=h.Array(a.length,0);for(b=0;b<c.length;b++)c[b]=this.get(a[b]);return c},getIndexedKeys:function(){var a,b,c=h.Array(this.size(),null);a=h.iter(this.map.keySet());for(b=
a.current;a.hasNext();b=a.next())c[this.map.get(b)]=b;return c},increment:function(a){var b;null!=a&&(b=this.get(a)+1,this.map.put(a,b),this.totalCount++,this.maxCount=Math.max(this.maxCount,b))},getTotalCount:function(){return this.totalCount},mode:function(){var a,b,c;if(h.isEmpty(this))return null;b=new h.List;a=h.iter(this.map.keySet());for(c=a.current;a.hasNext();c=a.next())this.map.get(c)==this.maxCount&&b.add(c);a=b.toArray();g.Data.sort(a);return a[Math.floor((a.length-1)/2)]},index:function(a){var b;
a=h.iter(a);for(b=a.current;a.hasNext();b=a.next())this.map.containsKey(b)||this.map.put(b,this.map.size());return this},isEmpty:function(){return h.isEmpty(this.map)},size:function(){return this.map.size()},sortedKeys:function(){var a=this.map.keySet().toArray();g.Data.sort(a);return a}});g.util_Range=function(a,b,c,e){this.low=a;this.high=b;this.mid=c;this.name=e};h.copy(g.util_Range,{make:function(a,b,c){return null==a||null==b?null:null==c?g.util_Range.makeNumeric(a,b,!1):g.util_Range.makeDate(a,
b,!1,c)},makeNumeric:function(a,b,c){var e=(b+a)/2;c=c?g.Data.formatNumeric(e,!0):g.Data.formatNumeric(a,!0)+"…"+g.Data.formatNumeric(b,!0);return new g.util_Range(a,b,e,c)},makeDate:function(a,b,c,e){var f=g.Data.asDate(a),h=g.Data.asDate(b);a=g.Data.asDate((b+a)/2);c=c?e.format(a):e.format(f)+"…"+e.format(h);return new g.util_Range(f,h,a,c)}});h.copy(g.util_Range.prototype,{compareTo:function(a){return g.Data.compare(this.asNumeric(),a.asNumeric())},asNumeric:function(){return(g.Data.asNumeric(this.low)+
g.Data.asNumeric(this.high))/2},extent:function(){return g.Data.asNumeric(this.high)-g.Data.asNumeric(this.low)},hashCode:function(){return this.name},equals:function(a){return this==a||a instanceof g.util_Range&&a.low==this.low&&a.high==this.high},toString:function(){return this.name}});g.values_ColumnProvider=function(a){var b,c,e,f=new h.Map;this.column=h.Array(a.length,null);for(b=0;b<a.length;b++)e=a[b],c=f.get(e),null==c?(f.put(e,e),this.column[b]=e):this.column[b]=c};h.copy(g.values_ColumnProvider,
{copy:function(a){var b,c=h.Array(a.count(),null);for(b=0;b<c.length;b++)c[b]=a.value(b);return new g.values_ColumnProvider(c)}});h.copy(g.values_ColumnProvider.prototype,{count:function(){return this.column.length},expectedSize:function(){var a,b,c=new h.Set,e=24+4*this.column.length;a=h.iter(this.column);for(b=a.current;a.hasNext();b=a.next())null!=b&&c.add(b)&&(e=b instanceof String?e+(42+2*h.len(b)):e+16);return e},setValue:function(a,b){this.column[b]=a;return this},compareRows:function(a,b,
c){a=this.column[a];b=this.column[b];return a==b?0:null==a?1:null==b?-1:h.isEmpty(c)?g.Data.compare(a,b):c.get(a)-c.get(b)},value:function(a){return this.column[a]}});g.values_ConstantProvider=function(a,b){this.o=a;this.len=b};h.copy(g.values_ConstantProvider.prototype,{compareRows:function(){return 0},count:function(){return this.len},expectedSize:function(){return 24},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,b)},value:function(){return this.o}});g.values_ReorderedProvider=
function(a,b){var c;if(a instanceof g.values_ReorderedProvider){this.base=a.base;this.order=h.Array(b.length,0);for(c=0;c<b.length;c++)this.order[c]=a.order[b[c]]}else this.base=a,this.order=b};h.copy(g.values_ReorderedProvider.prototype,{compareRows:function(a,b,c){return this.base.compareRows(this.order[a],this.order[b],c)},count:function(){return this.order.length},expectedSize:function(){return 24+4*this.order.length+this.base.expectedSize()},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,
b)},value:function(a){return this.base.value(this.order[a])}});g.values_RowProvider=function(a){this.len=a};h.copy(g.values_RowProvider.prototype,{count:function(){return this.len},expectedSize:function(){return 24},setValue:function(a,b){return g.values_ColumnProvider.copy(this).setValue(a,b)},value:function(a){return a+1},compareRows:function(a,b){return a-b}});return g}();
